<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë“œë¦¼ ìŠ¤íŠœë””ì˜¤ í…ŒìŠ¤íŠ¸ | ì†ì•ˆì— ê°€ì´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        
        /* Ken Burns ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes kenBurnsZoomIn {
            0% { transform: scale(1) translate(0, 0); }
            100% { transform: scale(1.3) translate(-5%, -5%); }
        }
        
        @keyframes kenBurnsZoomOut {
            0% { transform: scale(1.3) translate(-5%, -5%); }
            100% { transform: scale(1) translate(0, 0); }
        }
        
        @keyframes kenBurnsPanLeft {
            0% { transform: scale(1.2) translate(10%, 0); }
            100% { transform: scale(1.2) translate(-10%, 0); }
        }
        
        @keyframes kenBurnsPanRight {
            0% { transform: scale(1.2) translate(-10%, 0); }
            100% { transform: scale(1.2) translate(10%, 0); }
        }
        
        .ken-burns-zoom-in {
            animation: kenBurnsZoomIn 20s ease-in-out forwards;
        }
        
        .ken-burns-zoom-out {
            animation: kenBurnsZoomOut 20s ease-in-out forwards;
        }
        
        .ken-burns-pan-left {
            animation: kenBurnsPanLeft 20s ease-in-out forwards;
        }
        
        .ken-burns-pan-right {
            animation: kenBurnsPanRight 20s ease-in-out forwards;
        }
        
        /* ìë§‰ í•˜ì´ë¼ì´íŒ… */
        .subtitle-container {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            text-align: center;
        }
        
        .subtitle-text {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 18px;
            line-height: 1.6;
            display: inline-block;
        }
        
        .subtitle-word {
            transition: color 0.2s, font-weight 0.2s;
        }
        
        .subtitle-word.active {
            color: #fbbf24;
            font-weight: bold;
        }
        
        .subtitle-word.spoken {
            color: #9ca3af;
        }
        
        /* ë¹„ë””ì˜¤ ì»¨í…Œì´ë„ˆ */
        .video-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            aspect-ratio: 9/16;
            overflow: hidden;
            border-radius: 16px;
            background: #000;
        }
        
        .video-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* ì»¨íŠ¸ë¡¤ ë²„íŠ¼ */
        .control-btn {
            position: absolute;
            bottom: 16px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .control-btn:hover {
            background: white;
        }
    </style>
</head>
<body class="bg-gray-900 min-h-screen flex flex-col items-center justify-center p-4">
    
    <div class="text-center mb-6">
        <h1 class="text-2xl font-bold text-white mb-2">ğŸ¬ ë“œë¦¼ ìŠ¤íŠœë””ì˜¤ í…ŒìŠ¤íŠ¸</h1>
        <p class="text-gray-400 text-sm">Phase 1: CSS ì‹œë„¤ë§ˆí‹± + 1ì¸ì¹­ í˜ë¥´ì†Œë‚˜ + TTS</p>
    </div>
    
    <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ -->
    <div class="flex gap-2 mb-4 flex-wrap justify-center">
        <button onclick="selectCategory('db')" class="category-btn px-4 py-2 rounded-full bg-green-600 text-white text-sm" data-category="db">ğŸ“‚ DB ì´ë¯¸ì§€</button>
        <button onclick="selectCategory('landmark')" class="category-btn px-4 py-2 rounded-full bg-gray-700 text-white text-sm" data-category="landmark">ğŸ›ï¸ ì—¬í–‰ì§€</button>
        <button onclick="selectCategory('food')" class="category-btn px-4 py-2 rounded-full bg-gray-700 text-white text-sm" data-category="food">ğŸ• ìŒì‹</button>
        <button onclick="selectCategory('wine')" class="category-btn px-4 py-2 rounded-full bg-gray-700 text-white text-sm" data-category="wine">ğŸ· ì™€ì¸</button>
        <button onclick="selectCategory('art')" class="category-btn px-4 py-2 rounded-full bg-gray-700 text-white text-sm" data-category="art">ğŸ¨ ì˜ˆìˆ </button>
    </div>
    
    <!-- ìƒ˜í”Œ ì„ íƒ -->
    <div id="sample-selector" class="flex gap-2 mb-6 flex-wrap justify-center">
        <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
    </div>
    
    <!-- ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ -->
    <div class="video-container" id="videoContainer">
        <img id="mainImage" src="" alt="ì½˜í…ì¸  ì´ë¯¸ì§€" class="">
        <div class="subtitle-container">
            <div class="subtitle-text" id="subtitleText">
                ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”
            </div>
        </div>
        <button class="control-btn" id="playBtn" onclick="startPresentation()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="5 3 19 12 5 21 5 3" fill="currentColor"/>
            </svg>
        </button>
    </div>
    
    <!-- íš¨ê³¼ ì„ íƒ -->
    <div class="mt-6 flex gap-2 flex-wrap justify-center">
        <button onclick="setEffect('zoom-in')" class="effect-btn px-3 py-1 rounded bg-gray-700 text-white text-xs" data-effect="zoom-in">Zoom In</button>
        <button onclick="setEffect('zoom-out')" class="effect-btn px-3 py-1 rounded bg-gray-700 text-white text-xs" data-effect="zoom-out">Zoom Out</button>
        <button onclick="setEffect('pan-left')" class="effect-btn px-3 py-1 rounded bg-gray-700 text-white text-xs" data-effect="pan-left">Pan Left</button>
        <button onclick="setEffect('pan-right')" class="effect-btn px-3 py-1 rounded bg-gray-700 text-white text-xs" data-effect="pan-right">Pan Right</button>
    </div>
    
    <!-- ìƒíƒœ í‘œì‹œ -->
    <div class="mt-4 text-center">
        <p id="statusText" class="text-gray-500 text-sm">ëŒ€ê¸° ì¤‘...</p>
    </div>
    
    <!-- ë‹¨ê³„ ì•ˆë‚´ -->
    <div class="mt-8 max-w-md text-gray-400 text-xs">
        <p class="mb-2"><strong>ğŸ“‹ í…ŒìŠ¤íŠ¸ ë‹¨ê³„:</strong></p>
        <ul class="list-disc list-inside space-y-1">
            <li><span class="text-green-400">âœ… 1.1</span> 1ì¸ì¹­ í˜ë¥´ì†Œë‚˜ í”„ë¡¬í”„íŠ¸</li>
            <li><span class="text-green-400">âœ… 1.2</span> CSS Ken Burns íš¨ê³¼</li>
            <li><span class="text-green-400">âœ… 1.3</span> ìë§‰ í•˜ì´ë¼ì´íŒ… (ë…¸ë˜ë°©)</li>
            <li><span class="text-gray-500">ğŸ”² 1.4</span> ê´€ë¦¬ì ì„¤ì • UI</li>
        </ul>
    </div>

    <script>
        // ìƒ˜í”Œ ë°ì´í„°
        const samples = {
            landmark: [
                { 
                    id: 'eiffel', 
                    name: 'ì—í íƒ‘', 
                    image: 'https://images.unsplash.com/photo-1511739001486-6bfe10ce785f?w=800',
                    persona: 'ì½§ëŒ€ ë†’ì€ íŒŒë¦¬ì§€ì•µ ì•„ì €ì”¨',
                    script: 'ë´‰ì£¼ë¥´! ë‚˜ëŠ” ì—í íƒ‘ì´ì•¼. ì‚¬ëŒë“¤ì´ ë‚  ë³´ë©´ ë‹¤ ê°íƒ„í•˜ì§€. ì†”ì§íˆ ë§í•´ì„œ, ë§¤ë…„ 60í†¤ í˜ì¸íŠ¸ ì¹ í•˜ëŠë¼ ì •ë§ í˜ë“¤ì–´. í•˜ì§€ë§Œ íŒŒë¦¬ì˜ ìƒì§•ì´ ë˜ëŠ” ê±´ ë¿Œë“¯í•´. ë°¤ì— ë°˜ì§ë°˜ì§ ë¹›ë‚˜ëŠ” ë‚´ ëª¨ìŠµ, ì˜ˆì˜ì§€ ì•Šì•„?'
                },
                { 
                    id: 'colosseum', 
                    name: 'ì½œë¡œì„¸ì›€', 
                    image: 'https://images.unsplash.com/photo-1552832230-c0197dd311b5?w=800',
                    persona: 'ì€í‡´í•œ ê²€íˆ¬ì‚¬',
                    script: 'ì‚´ë² ! ë‚˜ëŠ” ì½œë¡œì„¸ì›€ì´ì•¼. ì˜›ë‚ ì—” 5ë§Œ ëª…ì´ ë‚˜í•œí…Œ í™˜í˜¸í–ˆëŠ”ë°, ì§€ê¸ˆì€ ì…€ì¹´ë§Œ ì°ì–´ê°€ë„¤. í•˜ì§€ë§Œ 2ì²œ ë…„ ë™ì•ˆ ì—¬ê¸° ì„œ ìˆìœ¼ë‹ˆê¹Œ, ì¸ìƒ ë­ ìˆì–´? ì²œì²œíˆ ì‚´ìê³ .'
                }
            ],
            food: [
                { 
                    id: 'baguette', 
                    name: 'ë°”ê²ŒíŠ¸', 
                    image: 'https://images.unsplash.com/photo-1549931319-a545dcf3bc73?w=800',
                    persona: 'ì½§ëŒ€ ë†’ì€ í”„ë‘ìŠ¤ ì‹ ì‚¬',
                    script: 'ë¬´ìŠˆ, ë§ˆë‹´! ì ˆ ê·¸ëƒ¥ ë¹µì´ë¼ê³  ë¶€ë¥´ì§€ ë§ˆì„¸ìš”. ì „ í”„ë‘ìŠ¤ì˜ ìì¡´ì‹¬, ë°”ê²ŒíŠ¸ì…ë‹ˆë‹¤! ê²‰ì€ ë”±ë”±í•´ ë³´ì—¬ë„ ì†ì€ ëˆ„êµ¬ë³´ë‹¤ ë¶€ë“œëŸ¬ìš´ ë‚¨ìì£ . ë‚  ê²¨ë“œë‘ì´ì— ë¼ê³  ê±·ëŠ” ë¡œë§, ë‹¤ë“¤ ìˆì£ ?'
                },
                { 
                    id: 'croissant', 
                    name: 'í¬ë£¨ì•„ìƒ', 
                    image: 'https://images.unsplash.com/photo-1555507036-ab1f4038808a?w=800',
                    persona: 'ê²Œìœ¼ë¥¸ ì•„ì¹¨í˜• ê·€ì¡±',
                    script: 'ì•„, ì•ˆë…•í•˜ì„¸ìš”. ì €ëŠ” í¬ë£¨ì•„ìƒì´ì—ìš”. ì €ëŠ” ì•„ì¹¨ì—ë§Œ ë¹›ë‚˜ëŠ” ìŠ¤íƒ€ì¼ì´ê±°ë“ ìš”. ë²„í„° 27ê²¹ì˜ ì˜ˆìˆ ì„ ëŠê»´ë³´ì„¸ìš”. ë°”ì‚­ë°”ì‚­ ì†Œë¦¬ê°€ ë“¤ë¦¬ì‹œì£ ? ê·¸ê²Œ ì €ì˜ ì‚¬ë‘ ê³ ë°±ì´ì—ìš”.'
                }
            ],
            wine: [
                { 
                    id: 'champagne', 
                    name: 'ìƒ´í˜ì¸', 
                    image: 'https://images.unsplash.com/photo-1594372365401-3b5ff14eaaed?w=800',
                    persona: 'íŒŒí‹°ê´‘ ì—¬ì™•',
                    script: 'íŒ¡! ì•ˆë…•, ë‚˜ëŠ” ìƒ´í˜ì¸ì´ì•¼! ì¶•í•˜í•  ì¼ ìˆì–´? ì—†ì–´ë„ ê´œì°®ì•„, ë‚˜ë‘ ë†€ë©´ ë˜ì§€! ê±°í’ˆì´ í†¡í†¡ í„°ì§€ëŠ” ì†Œë¦¬ ë“¤ë ¤? ê·¸ê²Œ ë°”ë¡œ í–‰ë³µì˜ ì†Œë¦¬ì•¼. ì, ê±´ë°°!'
                },
                { 
                    id: 'bordeaux', 
                    name: 'ë³´ë¥´ë„ ë ˆë“œ', 
                    image: 'https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=800',
                    persona: 'ì§„ì§€í•œ ì² í•™ì',
                    script: 'ë‚˜ëŠ” 20ë…„ì„ ê¸°ë‹¤ë ¸ì–´. ì¢‹ì€ ê²ƒì—” ì‹œê°„ì´ í•„ìš”í•˜ì§€. ì„±ê¸‰í•˜ê²Œ ë§ˆì‹œì§€ ë§ˆ. ì²œì²œíˆ, í–¥ì„ ìŒë¯¸í•˜ê³ , ì¸ìƒì„ ìƒê°í•´ë´. ë‚˜ì™€ í•¨ê»˜í•˜ëŠ” ì €ë…, ìŠì§€ ëª»í•  ê±°ì•¼.'
                }
            ],
            art: [
                { 
                    id: 'monalisa', 
                    name: 'ëª¨ë‚˜ë¦¬ì', 
                    image: 'https://images.unsplash.com/photo-1423742774270-6884aac775fa?w=800',
                    persona: 'ì‹ ë¹„ë¡œìš´ ë¯¸ì†Œ ë’¤ ìˆ˜ë‹¤ìŸì´',
                    script: 'ë´‰ì£¼ë¥´! ë‹¤ë“¤ ë‚´ ë¯¸ì†Œê°€ ì‹ ë¹„ë¡­ë‹¤ê³  ë‚œë¦¬ì¸ë°, ì‚¬ì‹¤ ì´ ë¯¸ì†Œ ìœ ì§€í•˜ëŠë¼ ì…ê°€ì— ê²½ë ¨ ë‚  ì§€ê²½ì´ì—ìš”. ë ˆì˜¤ë‚˜ë¥´ë„ ì•„ì €ì”¨ê°€ ëˆˆì¹ ê·¸ë¦¬ëŠ” ê±¸ ê¹œë¹¡í•˜ì‹  ê±´ì§€... ë‚´ ëˆˆì„ ë°”ë¼ë³´ë©´ì„œ ì†Œì›ì„ ë¹Œì–´ë´ìš”.'
                },
                { 
                    id: 'gogh', 
                    name: 'ê³ í ìí™”ìƒ', 
                    image: 'https://images.unsplash.com/photo-1579783902614-a3fb3927b6a5?w=800',
                    persona: 'ì—´ì •ì ì´ì§€ë§Œ ì™¸ë¡œìš´ ì˜í˜¼',
                    script: 'ë‚´ ëˆˆ ì†ì˜ íŒŒë€ ì†Œìš©ëŒì´ê°€ ë³´ì´ë‚˜ìš”? ë‚´ ë§ˆìŒì€ ì´ë ‡ê²Œ ë¶ˆíƒ€ì˜¤ë¥´ê³  ìˆì–´ìš”. ë¶•ëŒ€ ê°ì€ ê·€ëŠ” ë³´ì§€ ë§ˆì„¸ìš”. ëŒ€ì‹  ì œ ë¶“í„°ì¹˜ í•˜ë‚˜í•˜ë‚˜ì— ë‹´ê¸´ ì œ ì˜í˜¼ì˜ ë–¨ë¦¼ì„ ëŠê»´ì£¼ì„¸ìš”.'
                }
            ]
        };
        
        let currentCategory = 'db';
        let currentSample = null;
        let currentEffect = 'zoom-in';
        let isPlaying = false;
        let currentAudio = null;
        let dbSamples = []; // DBì—ì„œ ê°€ì ¸ì˜¨ ìƒ˜í”Œ
        
        // DBì—ì„œ ìƒ˜í”Œ ë¡œë“œ
        async function loadDbSamples() {
            try {
                document.getElementById('statusText').textContent = 'DBì—ì„œ ì´ë¯¸ì§€ ë¡œë”© ì¤‘...';
                const response = await fetch('/api/dream-studio/samples?limit=10');
                if (response.ok) {
                    const data = await response.json();
                    dbSamples = data.map(item => ({
                        id: item.id,
                        name: item.name,
                        image: item.image,
                        persona: '1ì¸ì¹­ í˜ë¥´ì†Œë‚˜ (AI ìƒì„± ì˜ˆì •)',
                        script: item.aiContent || item.description || 'ì´ ì¥ì†Œì— ëŒ€í•œ ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. AIê°€ 1ì¸ì¹­ìœ¼ë¡œ ì¬ë¯¸ìˆê²Œ ì„¤ëª…í•´ì¤„ ì˜ˆì •ì´ì—ìš”!',
                        originalDescription: item.description
                    }));
                    samples.db = dbSamples;
                    document.getElementById('statusText').textContent = `DBì—ì„œ ${dbSamples.length}ê°œ ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ`;
                    if (currentCategory === 'db') {
                        renderSamples();
                    }
                } else {
                    document.getElementById('statusText').textContent = 'DB ë¡œë“œ ì‹¤íŒ¨ - ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©';
                }
            } catch (error) {
                console.error('DB ë¡œë“œ ì—ëŸ¬:', error);
                document.getElementById('statusText').textContent = 'DB ì—°ê²° ì‹¤íŒ¨ - ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©';
            }
        }
        
        // ì¹´í…Œê³ ë¦¬ ì„ íƒ
        function selectCategory(category) {
            currentCategory = category;
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'bg-green-600');
                btn.classList.add('bg-gray-700');
            });
            const selectedBtn = document.querySelector(`[data-category="${category}"]`);
            selectedBtn.classList.remove('bg-gray-700');
            selectedBtn.classList.add(category === 'db' ? 'bg-green-600' : 'bg-blue-600');
            
            renderSamples();
        }
        
        // ìƒ˜í”Œ ë Œë”ë§
        function renderSamples() {
            const container = document.getElementById('sample-selector');
            const items = samples[currentCategory] || [];
            
            if (items.length === 0) {
                container.innerHTML = '<span class="text-gray-500 text-sm">ë¡œë”© ì¤‘...</span>';
                return;
            }
            
            container.innerHTML = items.map(item => `
                <button onclick="selectSample('${item.id}')" 
                        class="sample-btn px-3 py-1 rounded-full bg-gray-600 text-white text-sm hover:bg-gray-500"
                        data-sample="${item.id}">
                    ${item.name}
                </button>
            `).join('');
            
            // ì²« ë²ˆì§¸ ìƒ˜í”Œ ìë™ ì„ íƒ
            if (items.length > 0) {
                selectSample(items[0].id);
            }
        }
        
        // ìƒ˜í”Œ ì„ íƒ
        function selectSample(sampleId) {
            const items = samples[currentCategory];
            currentSample = items.find(item => item.id === sampleId);
            
            document.querySelectorAll('.sample-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500');
                btn.classList.add('bg-gray-600');
            });
            document.querySelector(`[data-sample="${sampleId}"]`)?.classList.remove('bg-gray-600');
            document.querySelector(`[data-sample="${sampleId}"]`)?.classList.add('bg-blue-500');
            
            // ì´ë¯¸ì§€ ë¡œë“œ
            const img = document.getElementById('mainImage');
            img.src = currentSample.image;
            img.className = '';
            
            // ìë§‰ ì´ˆê¸°í™”
            document.getElementById('subtitleText').innerHTML = `<em>${currentSample.persona}</em><br>ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”`;
            document.getElementById('statusText').textContent = `ì„ íƒ: ${currentSample.name}`;
        }
        
        // íš¨ê³¼ ì„ íƒ
        function setEffect(effect) {
            currentEffect = effect;
            document.querySelectorAll('.effect-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500');
                btn.classList.add('bg-gray-700');
            });
            document.querySelector(`[data-effect="${effect}"]`).classList.remove('bg-gray-700');
            document.querySelector(`[data-effect="${effect}"]`).classList.add('bg-blue-500');
        }
        
        // ì´ë¯¸ì§€ë¥¼ Base64ë¡œ ë³€í™˜
        async function imageToBase64(imageUrl) {
            try {
                const response = await fetch(imageUrl);
                const blob = await response.blob();
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(blob);
                });
            } catch (error) {
                console.error('ì´ë¯¸ì§€ ë³€í™˜ ì˜¤ë¥˜:', error);
                return null;
            }
        }
        
        // í”„ë ˆì  í…Œì´ì…˜ ì‹œì‘
        async function startPresentation() {
            if (!currentSample) return;
            if (isPlaying) {
                stopPresentation();
                return;
            }
            
            isPlaying = true;
            const playBtn = document.getElementById('playBtn');
            playBtn.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10" stroke-width="2"/>
                    <text x="12" y="16" text-anchor="middle" font-size="10" fill="currentColor">...</text>
                </svg>
            `;
            
            // Ken Burns íš¨ê³¼ ì ìš©
            const img = document.getElementById('mainImage');
            img.className = `ken-burns-${currentEffect}`;
            
            document.getElementById('statusText').textContent = 'ğŸ¤– AI í˜ë¥´ì†Œë‚˜ ìƒì„± ì¤‘...';
            document.getElementById('subtitleText').innerHTML = '<em>AIê°€ 1ì¸ì¹­ ëŒ€ì‚¬ë¥¼ ìƒì„±í•˜ê³  ìˆì–´ìš”...</em>';
            
            try {
                // ì´ë¯¸ì§€ë¥¼ base64ë¡œ ë³€í™˜
                const imageBase64 = await imageToBase64(currentSample.image);
                if (!imageBase64) throw new Error('ì´ë¯¸ì§€ ë³€í™˜ ì‹¤íŒ¨');
                
                // Gemini APIë¡œ í˜ë¥´ì†Œë‚˜ + TTS ìƒì„±
                const response = await fetch('/api/dream-studio/generate-persona', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({
                        imageBase64: imageBase64,
                        language: 'ko'
                    })
                });
                
                if (!response.ok) throw new Error('API ì˜¤ë¥˜');
                
                const data = await response.json();
                console.log('í˜ë¥´ì†Œë‚˜ ìƒì„± ê²°ê³¼:', data);
                
                document.getElementById('statusText').textContent = `ğŸ­ ${data.persona} (${data.mood})`;
                
                // ìë§‰ ì¤€ë¹„
                const words = data.script.split(' ');
                const subtitleEl = document.getElementById('subtitleText');
                subtitleEl.innerHTML = words.map((word, i) => 
                    `<span class="subtitle-word" data-index="${i}">${word}</span>`
                ).join(' ');
                
                // ë²„íŠ¼ì„ ì¼ì‹œì •ì§€ë¡œ ë³€ê²½
                playBtn.innerHTML = `
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="6" y="4" width="4" height="16" fill="currentColor"/>
                        <rect x="14" y="4" width="4" height="16" fill="currentColor"/>
                    </svg>
                `;
                
                // Gemini TTS ì˜¤ë””ì˜¤ ì¬ìƒ
                if (data.audio && data.audio.data) {
                    playGeminiAudio(data.audio.data, data.audio.mimeType, words);
                } else {
                    // TTS ì—†ìœ¼ë©´ ë¸Œë¼ìš°ì € TTS í´ë°±
                    console.log('Gemini TTS ì—†ìŒ, ë¸Œë¼ìš°ì € TTS ì‚¬ìš©');
                    playBrowserTTS(data.script, words);
                }
                
            } catch (error) {
                console.error('í˜ë¥´ì†Œë‚˜ ìƒì„± ì˜¤ë¥˜:', error);
                document.getElementById('statusText').textContent = 'âŒ ìƒì„± ì‹¤íŒ¨ - ìƒ˜í”Œ TTS ì‚¬ìš©';
                
                // í´ë°±: ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë¸Œë¼ìš°ì € TTS
                const words = currentSample.script.split(' ');
                const subtitleEl = document.getElementById('subtitleText');
                subtitleEl.innerHTML = words.map((word, i) => 
                    `<span class="subtitle-word" data-index="${i}">${word}</span>`
                ).join(' ');
                
                playBtn.innerHTML = `
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="6" y="4" width="4" height="16" fill="currentColor"/>
                        <rect x="14" y="4" width="4" height="16" fill="currentColor"/>
                    </svg>
                `;
                
                playBrowserTTS(currentSample.script, words);
            }
        }
        
        // Gemini TTS ì˜¤ë””ì˜¤ ì¬ìƒ (PCM â†’ WAV)
        function playGeminiAudio(base64Data, mimeType, words) {
            try {
                // PCM ë°ì´í„°ë¥¼ WAVë¡œ ë³€í™˜
                const pcmData = atob(base64Data);
                const pcmArray = new Uint8Array(pcmData.length);
                for (let i = 0; i < pcmData.length; i++) {
                    pcmArray[i] = pcmData.charCodeAt(i);
                }
                
                // WAV í—¤ë” ìƒì„± (24kHz, 16-bit, mono)
                const sampleRate = 24000;
                const numChannels = 1;
                const bitsPerSample = 16;
                const wavHeader = createWavHeader(pcmArray.length, sampleRate, numChannels, bitsPerSample);
                
                // WAV íŒŒì¼ ìƒì„±
                const wavData = new Uint8Array(wavHeader.length + pcmArray.length);
                wavData.set(wavHeader, 0);
                wavData.set(pcmArray, wavHeader.length);
                
                const blob = new Blob([wavData], { type: 'audio/wav' });
                const audioUrl = URL.createObjectURL(blob);
                
                currentAudio = new Audio(audioUrl);
                
                // ë‹¨ì–´ í•˜ì´ë¼ì´íŒ…
                let wordIndex = 0;
                const avgDuration = (currentAudio.duration || 15) * 1000 / words.length;
                
                currentAudio.onplay = () => {
                    const duration = currentAudio.duration * 1000;
                    const wordDuration = duration / words.length;
                    
                    const highlightInterval = setInterval(() => {
                        if (wordIndex >= words.length || !isPlaying) {
                            clearInterval(highlightInterval);
                            return;
                        }
                        
                        document.querySelectorAll('.subtitle-word').forEach((el, i) => {
                            el.classList.remove('active');
                            if (i < wordIndex) el.classList.add('spoken');
                        });
                        
                        const currentWord = document.querySelector(`[data-index="${wordIndex}"]`);
                        if (currentWord) currentWord.classList.add('active');
                        
                        wordIndex++;
                    }, wordDuration || 300);
                };
                
                currentAudio.onended = () => {
                    stopPresentation();
                };
                
                currentAudio.onerror = (e) => {
                    console.error('ì˜¤ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜:', e);
                    playBrowserTTS(words.join(' '), words);
                };
                
                currentAudio.play();
                document.getElementById('statusText').textContent = 'ğŸ™ï¸ Gemini TTS ì¬ìƒ ì¤‘...';
                
            } catch (error) {
                console.error('Gemini ì˜¤ë””ì˜¤ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                playBrowserTTS(words.join(' '), words);
            }
        }
        
        // WAV í—¤ë” ìƒì„±
        function createWavHeader(dataLength, sampleRate, numChannels, bitsPerSample) {
            const header = new ArrayBuffer(44);
            const view = new DataView(header);
            
            const writeString = (offset, str) => {
                for (let i = 0; i < str.length; i++) {
                    view.setUint8(offset + i, str.charCodeAt(i));
                }
            };
            
            writeString(0, 'RIFF');
            view.setUint32(4, 36 + dataLength, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * numChannels * bitsPerSample / 8, true);
            view.setUint16(32, numChannels * bitsPerSample / 8, true);
            view.setUint16(34, bitsPerSample, true);
            writeString(36, 'data');
            view.setUint32(40, dataLength, true);
            
            return new Uint8Array(header);
        }
        
        // ë¸Œë¼ìš°ì € TTS (í´ë°±)
        function playBrowserTTS(text, words) {
            const speechSynthesis = window.speechSynthesis;
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ko-KR';
            utterance.rate = 0.9;
            
            const voices = speechSynthesis.getVoices();
            const koreanVoice = voices.find(v => v.lang.includes('ko'));
            if (koreanVoice) utterance.voice = koreanVoice;
            
            let wordIndex = 0;
            const avgDuration = (text.length * 80) / words.length;
            
            const highlightInterval = setInterval(() => {
                if (wordIndex >= words.length || !isPlaying) {
                    clearInterval(highlightInterval);
                    return;
                }
                
                document.querySelectorAll('.subtitle-word').forEach((el, i) => {
                    el.classList.remove('active');
                    if (i < wordIndex) el.classList.add('spoken');
                });
                
                const currentWord = document.querySelector(`[data-index="${wordIndex}"]`);
                if (currentWord) currentWord.classList.add('active');
                
                wordIndex++;
            }, avgDuration);
            
            utterance.onend = () => {
                clearInterval(highlightInterval);
                stopPresentation();
            };
            
            speechSynthesis.speak(utterance);
            document.getElementById('statusText').textContent = 'ğŸ”Š ë¸Œë¼ìš°ì € TTS ì¬ìƒ ì¤‘...';
        }
        
        // í”„ë ˆì  í…Œì´ì…˜ ì¤‘ì§€
        function stopPresentation() {
            isPlaying = false;
            
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            window.speechSynthesis?.cancel();
            
            const playBtn = document.getElementById('playBtn');
            playBtn.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="5 3 19 12 5 21 5 3" fill="currentColor"/>
                </svg>
            `;
            
            const img = document.getElementById('mainImage');
            img.className = '';
            
            document.getElementById('statusText').textContent = 'ì™„ë£Œ';
        }
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async () => {
            samples.db = []; // DB ì¹´í…Œê³ ë¦¬ ì´ˆê¸°í™”
            setEffect('zoom-in');
            selectCategory('db'); // DB ì¹´í…Œê³ ë¦¬ ë¨¼ì € ì„ íƒ
            await loadDbSamples(); // DB ì´ë¯¸ì§€ ë¡œë“œ
        });
    </script>
</body>
</html>
