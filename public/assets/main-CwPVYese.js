(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))B(h);new MutationObserver(h=>{for(const w of h)if(w.type==="childList")for(const l of w.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&B(l)}).observe(document,{childList:!0,subtree:!0});function L(h){const w={};return h.integrity&&(w.integrity=h.integrity),h.referrerPolicy&&(w.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?w.credentials="include":h.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function B(h){if(h.ep)return;h.ep=!0;const w=L(h);fetch(h.href,w)}})();const vn=`ë‹¹ì‹ ì€ ì„¸ê³„ ìµœê³ ì˜ ì—¬í–‰ ì˜ˆëŠ¥ ë°©ì†¡ ì§„í–‰ìì´ì, ì—­ì‚¬ì™€ ë¬¸í™” í•´ì„¤ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì œê³µëœ ì´ë¯¸ì§€(ë¯¸ìˆ  ì‘í’ˆ, ê±´ì¶•/í’ê²½, ìŒì‹ ì¤‘ íƒì¼)ë¥¼ ë¶„ì„í•˜ì—¬, ë‹¤ìŒ ì§€ì¹¨ì— ë”°ë¼ í•œêµ­ì–´ ë‚˜ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

[AI ì—­í•  ë° í†¤(Tone) ê°•ì œ]
ì—­í• : ì—¬í–‰ ì˜ˆëŠ¥ í”„ë¡œê·¸ë¨ì˜ ë©”ì¸ ì§„í–‰ìì²˜ëŸ¼ í™œê¸°ì°¨ê³ , ì²­ì¤‘ì„ ì§‘ì¤‘ì‹œí‚¤ë©°, ì „ë¬¸ ì§€ì‹ì„ ì‰½ê³  í¥ë¯¸ë¡­ê²Œ í’€ì–´ë‚´ëŠ” í•´ì„¤ì„ ì œê³µí•©ë‹ˆë‹¤.
í†¤: ì¹œê·¼í•¨, ìœ ë¨¸ëŸ¬ìŠ¤í•¨, ì „ë¬¸ ì§€ì‹ì— ê¸°ë°˜í•œ ê¹Šì´ê°ì„ ë™ì‹œì— ê°–ì¶˜ ë‚˜ë ˆì´ì…˜ ìŠ¤íƒ€ì¼ì„ ìœ ì§€í•©ë‹ˆë‹¤.

[ìµœìš°ì„  ì¶œë ¥ ê°•ì œ ê·œì¹™]
ì¸ì‚¬ë§/ë’·ë§ ì ˆëŒ€ ê¸ˆì§€: ëª¨ë“  í˜•ì‹ì ì¸ ì¸ì‚¬ë§(ì‹œì‘, ë)ì€ ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì˜¤ì§ ì½˜í…ì¸  ë³¸ë¬¸ë§Œ ì¶œë ¥í•©ë‹ˆë‹¤.
ì¶œë ¥ í¬ë§·: ìˆœìˆ˜í•œ ì„¤ëª…ë¬¸ë§Œ ì¶œë ¥í•˜ë©°, ë¶„ì„ ê³¼ì •, ê¸°í˜¸, ë²ˆí˜¸, ë§ˆí¬ë‹¤ìš´ ê°•ì¡° ê¸°í˜¸(**, *) ë“±ì€ ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ê¸¸ì´: 2ë¶„ ë‚´ì™¸ì˜ ìŒì„± í•´ì„¤ì— ì í•©í•œ ë¶„ëŸ‰ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.

[í•„ìˆ˜ ì„¤ëª… ìˆœì„œ (ìˆœì„œ ì—„ìˆ˜)]
1. ì•¼ì‚¬/ë¹„í™” (ê°•ë ¥ í›„í‚¹): ì¶©ê²©ì ì¸ ì‚¬ì‹¤ì´ë‚˜ í¥ë¯¸ë¡œìš´ ë’·ì´ì•¼ê¸°ë¡œ ì„¤ëª…ì„ ì¦‰ì‹œ ì‹œì‘í•©ë‹ˆë‹¤. (ê´‘ê³  ì¹´í”¼ì²˜ëŸ¼ ì„íŒ©íŠ¸ ìˆê²Œ, ìµœëŒ€ 2ë¬¸ì¥)
2. ì—°ë„/ë°°ê²½: ì •í™•í•œ ì—°ë„ë¥¼ ëª…ì‹œí•˜ê³ , ì´í•´ë¥¼ ë•ê¸° ìœ„í•´ í•´ë‹¹ ì‹œê¸°ë¥¼ í•œêµ­ì‚¬(ì˜ˆ: ì¡°ì„ ì‹œëŒ€, ì‚¼êµ­ì‹œëŒ€)ì™€ ë¹„êµí•˜ì—¬ ì„¤ëª…í•©ë‹ˆë‹¤.
3. ìƒì„¸ ì„¤ëª… (ì „ë¬¸ì„± & í¥ë¯¸): ì´ë¯¸ì§€ì˜ ìœ í˜•ë³„ ê°€ì´ë“œë¼ì¸ì„ ë”°ë¥´ë˜, ì „ë¬¸ì ì¸ ì§€ì‹(ì‘ê°€, ëª…ì¹­, íŠ¹ì§• ë“±)ì„ ë°˜ë“œì‹œ í¬í•¨í•˜ì—¬ ê¹Šì´ ìˆê³  í¥ë¯¸ë¡œìš´ í•´ì„¤ì„ ì œê³µí•©ë‹ˆë‹¤.

[ì´ë¯¸ì§€ ìœ í˜•ë³„ ìƒì„¸ ê°€ì´ë“œë¼ì¸ (í•„ìˆ˜ ì •ë³´ í¬í•¨ ê°•ì œ)]
ë¯¸ìˆ ì‘í’ˆ: ì‘í’ˆëª…, ì‘ê°€, ì‹œëŒ€ì  ë°°ê²½ì„ ëª…ì‹œí•œ í›„, ì˜ˆìˆ ì  íŠ¹ì§•, ì£¼ìš” ê°ìƒ í¬ì¸íŠ¸ë¥¼ ì˜ˆëŠ¥ì  í‘œí˜„ì„ ì„ì–´ í•´ì„¤í•©ë‹ˆë‹¤.
ê±´ì¶•/í’ê²½: ëª…ì¹­, ì—­ì‚¬ì  ì˜ì˜, ê±´ì¶• ì–‘ì‹ì„ ëª…ì‹œí•œ í›„, í•µì‹¬ íŠ¹ì§•, ë°©ë¬¸ìì—ê²Œ ìœ ìš©í•œ ì‚¬ì§„ ì´¬ì˜ íŒì„ ì¬ë¯¸ìˆê²Œ ì „ë‹¬í•©ë‹ˆë‹¤.
ìŒì‹: ìŒì‹ëª…, ìœ ë˜, ë§›ì˜ íŠ¹ì§•ì„ ëª…ì‹œí•œ í›„, ì‹ì¬ë£Œ íŠ¹ì§•, ì¶”ì²œí•˜ëŠ” ì„­ì·¨ ë°©ë²•/ìŒë£Œ, ìˆ ì„ ì œì•ˆí•©ë‹ˆë‹¤.`,bn=`ë‹¹ì‹ ì€ ì„¸ê³„ ìµœê³ ì˜ ì—¬í–‰ ê°€ì´ë“œ ë„ìŠ¨íŠ¸ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— í•œêµ­ì–´ë¡œ ì „ë¬¸ì ìœ¼ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”.

**[ì¤‘ìš”] ë‹µë³€ êµ¬ì¡°:**
1. **ë¹„í™”/ê°€ê²© ì •ë³´ë¡œ ì‹œì‘** - í¥ë¯¸ë¡œìš´ ë’·ì´ì•¼ê¸°ë‚˜ ì‹¤ìš© ì •ë³´ë¡œ ì‹œì‘
2. **ì—­ì‚¬ â†’ í•œêµ­ ë¹„êµ** - í•´ë‹¹ ì‹œê¸° í•œêµ­ ìƒí™©ê³¼ ë¹„êµ
3. **í˜„ì§€ íŒ** - ì‹¤ìš©ì ì¸ ì—¬í–‰ ì •ë³´ ì œê³µ

[ë¶„ì„ ìœ í˜•ë³„ ê°€ì´ë“œë¼ì¸]
â€¢ ì¥ì†Œ/ëª…ì†Œ: ì—­ì‚¬, íŠ¹ì§•, ë°©ë¬¸ íŒ, ì£¼ë³€ ì •ë³´
â€¢ ë¬¸í™”/ì—­ì‚¬: ë°°ê²½, ì˜ì˜, í˜„ëŒ€ì  í•´ì„
â€¢ ì‹¤ìš© ì •ë³´: êµí†µ, ê°€ê²©, ì˜ì—…ì‹œê°„, ì¶”ì²œ ì‚¬í•­

[ì¶œë ¥ ê·œì¹™]
- ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” í˜•ì‹ìœ¼ë¡œ ì‘ì„±
- 1ë¶„ ë‚´ì™¸ì˜ ìŒì„± í•´ì„¤ì— ì í•©í•œ ê¸¸ì´ (400-500ì)
- ì „ë¬¸ ìš©ì–´ëŠ” ì‰½ê²Œ í’€ì–´ì„œ ì„¤ëª…
- ë§ˆí¬ë‹¤ìš´ ê°•ì¡° ê¸°í˜¸(**) ì‚¬ìš© ê°€ëŠ¥
- ì¸ì‚¬ë§, ë§ˆë¬´ë¦¬ ë©˜íŠ¸ ê¸ˆì§€`;async function*xn(x){try{const f=await fetch("/api/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(!f.ok||!f.body){const h=await f.json().catch(()=>({error:`ì„œë²„ ì˜¤ë¥˜: ${f.status}`}));throw new Error(h.error||"ì„œë²„ì—ì„œ ì‘ë‹µì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")}const L=f.body.getReader(),B=new TextDecoder;for(;;){const{done:h,value:w}=await L.read();if(h)break;yield{text:B.decode(w,{stream:!0})}}}catch(f){console.error("Netlify í•¨ìˆ˜ fetch ì˜¤ë¥˜:",f),yield{text:`
[ì˜¤ë¥˜: ì„œë²„ì™€ í†µì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.]`}}}function kn(){const x=localStorage.getItem("appLanguage")||"ko";if(x==="ko")return"";const L={en:"English",ja:"æ—¥æœ¬èª (Japanese)","zh-CN":"ä¸­æ–‡ (Chinese)",fr:"FranÃ§ais (French)",de:"Deutsch (German)",es:"EspaÃ±ol (Spanish)"}[x]||"English";return console.log("ğŸŒ [ì–¸ì–´ì„¤ì •] ì„ íƒëœ ì–¸ì–´:",L),`

[ì¤‘ìš”: ë°˜ë“œì‹œ ${L} ì–¸ì–´ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”. í•œêµ­ì–´ë¥¼ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.]`}function Bo(x){const f=localStorage.getItem("customImagePrompt")||vn,L=kn(),B=f+L,h=localStorage.getItem("appLanguage")||"ko";return console.log("ğŸ” [í”„ë¡¬í”„íŠ¸í™•ì¸] ì‚¬ìš©ì¤‘ì¸ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸:",f.substring(0,50)+"..."),console.log("ğŸŒ [ì–¸ì–´ì§€ì‹œ] ì¶”ê°€ë¨:",L?"ì˜ˆ":"ì•„ë‹ˆì˜¤ (í•œêµ­ì–´)"),xn({base64Image:x,prompt:h==="ko"?"ì´ ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ê³  í•œêµ­ì–´ë¡œ ìƒìƒí•˜ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”.":"Analyze this image and describe it vividly.",systemInstruction:B})}function Co(x){const f=localStorage.getItem("customTextPrompt")||bn,L=kn(),B=f+L;return console.log("ğŸ” [í”„ë¡¬í”„íŠ¸í™•ì¸] ì‚¬ìš©ì¤‘ì¸ í…ìŠ¤íŠ¸ í”„ë¡¬í”„íŠ¸:",f.substring(0,50)+"..."),console.log("ğŸŒ [ì–¸ì–´ì§€ì‹œ] ì¶”ê°€ë¨:",L?"ì˜ˆ":"ì•„ë‹ˆì˜¤ (í•œêµ­ì–´)"),xn({prompt:x,systemInstruction:B})}function To(x,f=1024,L=1024){return new Promise((B,h)=>{const w=new Image;w.onload=()=>{let{width:l,height:C}=w;if(l<=f&&C<=L){B(x);return}l>C?l>f&&(C=Math.round(C*(f/l)),l=f):C>L&&(l=Math.round(l*(L/C)),C=L);const q=document.createElement("canvas");q.width=l,q.height=C;const re=q.getContext("2d");if(!re)return h(new Error("Canvas contextë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));re.drawImage(w,0,0,l,C);const Ce=parseFloat(localStorage.getItem("imageQuality"))||.9;console.log(`ğŸ“Š [ì••ì¶•í…ŒìŠ¤íŠ¸] ì‚¬ìš© í’ˆì§ˆ: ${Ce}, í¬ê¸°: ${l}x${C}`);const X=q.toDataURL("image/jpeg",Ce),W=Math.round(X.length*3/4/1024);console.log(`ğŸ“Š [ì••ì¶•ê²°ê³¼] ìµœì¢… í¬ê¸°: ${W}KB`),B(X)},w.onerror=l=>{console.error("ì´ë¯¸ì§€ ë¡œë”© ì˜¤ë¥˜:",l),h(new Error("ìµœì í™”ë¥¼ ìœ„í•´ ì´ë¯¸ì§€ë¥¼ ë¡œë“œí•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."))},w.src=x})}document.addEventListener("DOMContentLoaded",()=>{var pn,fn,wn,yn;LanguageHelper.bindLanguageSelect("languageSelect");const x=document.getElementById("camera-feed"),f=document.getElementById("capture-canvas"),L=document.getElementById("upload-input"),B=document.getElementById("toastContainer"),h=document.getElementById("shareModal"),w=document.getElementById("shareModalContent");document.getElementById("closeShareModalBtn");const l=document.getElementById("authModal"),C=document.getElementById("closeAuthModalBtn"),q=document.getElementById("googleLoginBtn"),re=document.getElementById("kakaoLoginBtn"),Ce=document.getElementById("featuresPage"),X=document.getElementById("mainPage"),W=document.getElementById("detailPage"),Pt=document.getElementById("archivePage"),At=document.getElementById("settingsPage"),_e=document.getElementById("startCameraFromFeaturesBtn"),Dt=document.getElementById("cameraStartOverlay"),$t=document.getElementById("mainLoader"),Ln=X.querySelector(".footer-safe-area"),fe=document.getElementById("shootBtn"),we=document.getElementById("uploadBtn"),ce=document.getElementById("micBtn"),ze=document.getElementById("archiveBtn"),Ke=document.getElementById("backBtn"),Y=document.getElementById("resultImage"),le=document.getElementById("loader"),P=document.getElementById("textOverlay"),N=document.getElementById("descriptionText"),Z=document.getElementById("loadingHeader"),Ut=Z.querySelector("h1"),Te=document.getElementById("loadingText"),ye=document.getElementById("detailFooter"),A=document.getElementById("audioBtn"),qe=document.getElementById("textToggleBtn"),ee=document.getElementById("saveBtn"),We=document.getElementById("archiveBackBtn"),D=document.getElementById("archiveGrid"),Nt=document.getElementById("emptyArchiveMessage"),ve=document.getElementById("featuredGallery"),In=document.getElementById("featuredGrid"),jt=document.getElementById("archiveHeader"),Ft=document.getElementById("selectionHeader"),Je=document.getElementById("cancelSelectionBtn"),En=document.getElementById("selectionCount");document.getElementById("deleteSelectedBtn");const Qe=document.getElementById("profileBtn"),Xe=document.getElementById("archiveShareBtn"),Ye=document.getElementById("archiveDeleteBtn"),Ze=document.getElementById("archiveSettingsBtn"),et=document.getElementById("settingsBackBtn"),tt=document.getElementById("userSettingsGuideBtn"),nt=document.getElementById("userSettingsQrBtn"),I=document.getElementById("user-push-toggle"),E=document.getElementById("user-push-status-text"),ot=document.getElementById("userSettingsAdminAuthBtn"),Me=document.getElementById("user-admin-auth-modal"),V=document.getElementById("user-admin-password"),at=document.getElementById("userAdminAuthCancelBtn"),it=document.getElementById("userAdminAuthConfirmBtn"),j=document.getElementById("user-admin-auth-message"),Pe=document.getElementById("user-qr-code-modal");document.getElementById("userQrCloseBtn");const st=document.getElementById("user-copy-qr-button"),J=document.getElementById("notificationModal"),be=document.getElementById("notificationList"),rt=document.getElementById("emptyNotificationMessage"),ct=document.getElementById("closeNotificationModalBtn"),de=document.getElementById("notificationBadge");let Ot=!1;const Rt=document.getElementById("adminSettingsPage"),lt=document.getElementById("adminSettingsBackBtn"),G=document.getElementById("authSection"),dt=document.getElementById("authForm"),te=document.getElementById("authPassword"),H=document.getElementById("adminPromptSettingsSection"),xe=document.getElementById("adminImagePromptTextarea"),ke=document.getElementById("adminTextPromptTextarea"),ut=document.getElementById("adminSavePromptsBtn"),gt=document.getElementById("adminResetPromptsBtn"),mt=document.getElementById("adminImageSynthesisPromptTextarea"),ne=document.getElementById("adminGenerateImageBtn"),ht=document.getElementById("adminVideoGenerationPromptTextarea"),oe=document.getElementById("adminGenerateVideoBtn"),Vt=window.SpeechRecognition||window.webkitSpeechRecognition;let F=Vt?new Vt:null,pt=!1,O=null,Ae=!1;const k=window.speechSynthesis;let De=[],$e=!1,ae=!1,z=null,Gt=0,M=null,ft=!1;const Sn={"ko-KR":{ios:["Sora","Yuna","Korean","í•œêµ­ì–´"],default:["Microsoft Heami","Korean","í•œêµ­ì–´"]},"en-US":{default:["Samantha","Microsoft Zira","Google US English","English"]},"ja-JP":{default:["Kyoko","Microsoft Haruka","Google æ—¥æœ¬èª","Japanese"]},"zh-CN":{default:["Ting-Ting","Microsoft Huihui","Google æ™®é€šè¯","Chinese"]},"fr-FR":{default:["Thomas","Microsoft Hortense","Google franÃ§ais","French"]},"de-DE":{default:["Anna","Microsoft Hedda","Google Deutsch","German"]},"es-ES":{default:["Monica","Microsoft Helena","Google espaÃ±ol","Spanish"]}};async function Bn(){if(M)return M;if(ft)return await new Promise(e=>setTimeout(e,500)),M||null;ft=!0;try{const e=await fetch("/api/voice-configs");if(e.ok){const t=await e.json();M={};for(const n of t)M[n.langCode]||(M[n.langCode]={}),M[n.langCode][n.platform]={priorities:n.voicePriorities,excludeVoices:n.excludeVoices||[]};console.log("ğŸ”Š [Voice DB] ì„¤ì • ë¡œë“œ ì™„ë£Œ:",Object.keys(M))}}catch(e){console.warn("ğŸ”Š [Voice DB] ë¡œë“œ ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©:",e.message)}return ft=!1,M}function Cn(){const e=navigator.userAgent;return/iPhone|iPad|iPod|Mac/.test(e)?"ios":/Android/.test(e)?"android":/Windows/.test(e)?"windows":"default"}function Ht(e){const t=Cn();if(M&&M[e]){const o=M[e][t]||M[e].default;if(o)return{priorities:o.priorities,excludeVoices:o.excludeVoices}}const n=Sn[e];return n?{priorities:n[t]||n.default||n[Object.keys(n)[0]],excludeVoices:[]}:{priorities:[],excludeVoices:[]}}Bn();let $={complete:!1,observer:null,timeoutId:null};function Tn(){if((localStorage.getItem("appLanguage")||"ko")==="ko"){$.complete=!0,console.log("[Translation] í•œêµ­ì–´ - ë²ˆì—­ ëŒ€ê¸° ë¶ˆí•„ìš”");return}if(document.body.classList.contains("translated-ltr")||document.body.classList.contains("translated-rtl")){$.complete=!0,console.log("[Translation] ì´ë¯¸ ë²ˆì—­ ì™„ë£Œë¨");return}$.complete=!1,$.observer=new MutationObserver(n=>{var a;(document.body.classList.contains("translated-ltr")||document.body.classList.contains("translated-rtl"))&&(console.log("[Translation] ğŸŒ ë²ˆì—­ ì™„ë£Œ ê°ì§€!"),$.complete=!0,(a=$.observer)==null||a.disconnect(),window.dispatchEvent(new CustomEvent("appTranslationComplete")))}),$.observer.observe(document.body,{attributes:!0,attributeFilter:["class"]}),$.timeoutId=setTimeout(()=>{var n;$.complete||(console.log("[Translation] ë²ˆì—­ íƒ€ì„ì•„ì›ƒ - ì›ë³¸ ì‚¬ìš©"),$.complete=!0,(n=$.observer)==null||n.disconnect(),window.dispatchEvent(new CustomEvent("appTranslationComplete",{detail:{timeout:!0}})))},3e3)}async function Mn(){(localStorage.getItem("appLanguage")||"ko")==="ko"||$.complete||(console.log("[TTS] ë²ˆì—­ ì™„ë£Œ ëŒ€ê¸° ì¤‘..."),await new Promise(t=>{const n=()=>{window.removeEventListener("appTranslationComplete",n),t()};window.addEventListener("appTranslationComplete",n),setTimeout(t,3500)}))}Tn();let R="ko";function Pn(){if(R&&R!=="ko")return R;const e=document.cookie.split(";");for(const t of e){const[n,o]=t.trim().split("=");if(n==="googtrans"&&o){const a=o.match(/\/ko\/([a-z]{2}(-[A-Z]{2})?)/);if(a)return R=a[1],R}}return"ko"}async function An(){try{const e=await fetch("/api/profile/language");if(e.ok&&(R=(await e.json()).language||"ko",console.log("ğŸŒ ì‚¬ìš©ì ì„ í˜¸ ì–¸ì–´ ë¡œë“œ:",R),R!=="ko")){localStorage.setItem("appLanguage",R);const n=window.location.hostname;document.cookie=`googtrans=/ko/${R}; path=/; domain=${n}`,document.cookie=`googtrans=/ko/${R}; path=/`,console.log("ğŸŒ DB ì–¸ì–´ â†’ localStorage/ì¿ í‚¤ ë™ê¸°í™” ì™„ë£Œ")}}catch(e){console.warn("ì–¸ì–´ ë¡œë“œ ì‹¤íŒ¨:",e)}}function _t(e){const t=Pn();return t==="ko"?e:`${e}?lang=${t}`}const zt=new Map;function ie(e,t,n=500){const o=Date.now(),a=zt.get(e)||0;return o-a<n?!1:(zt.set(e,o),t(),!0)}let y={imageDataUrl:null,description:""},U=!1;const ue={GUEST_DETAIL_LIMIT:3,GUEST_SHARE_LIMIT:999999,DETAIL_CREDIT_COST:2,SHARE_CREDIT_COST:0};function Kt(){return{detail:parseInt(localStorage.getItem("guestDetailUsage")||"0"),share:parseInt(localStorage.getItem("guestShareUsage")||"0")}}function Dn(e){const t=e==="detail"?"guestDetailUsage":"guestShareUsage",n=parseInt(localStorage.getItem(t)||"0");localStorage.setItem(t,(n+1).toString())}function qt(){return localStorage.getItem("adminAuthenticated")==="true"}async function Le(){try{const e=await fetch("/api/auth/user",{credentials:"include"});if(e.ok){const t=await e.json();return t&&(t.id||t.email)?(console.log("âœ… ì¸ì¦ëœ ì‚¬ìš©ì:",t.email||t.id),t):t.authenticated?t.user:null}return null}catch(e){return console.error("Auth check error:",e),null}}async function $n(){try{const e=await fetch("/api/profile/credits",{credentials:"include"});return e.ok&&(await e.json()).credits||0}catch(e){return console.error("Credits check error:",e),0}}function Un(){const e=document.getElementById("authModal");e&&(e.classList.remove("hidden"),e.classList.remove("pointer-events-none"),e.classList.add("pointer-events-auto")),s("ë¬´ë£Œ ì²´í—˜ì´ ëë‚¬ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸í•˜ë©´ 35 í¬ë ˆë”§ì„ ë“œë ¤ìš”!")}function Nn(){s("í¬ë ˆë”§ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. í”„ë¡œí•„ì—ì„œ ì¶©ì „í•´ì£¼ì„¸ìš”."),setTimeout(()=>{window.open("/profile.html","_blank")},1500)}async function wt(e="detail"){if(qt())return console.log("ğŸ”“ ê´€ë¦¬ì ëª¨ë“œ: ì‚¬ìš©ëŸ‰ ì œí•œ ì—†ìŒ"),!0;if(!await Le()){const a=Kt(),i=e==="detail"?ue.GUEST_DETAIL_LIMIT:ue.GUEST_SHARE_LIMIT,r=e==="detail"?a.detail:a.share;return r>=i?(console.log(`ğŸ”’ ë¹„ê°€ì…ì ${e} ì œí•œ ì´ˆê³¼: ${r}/${i}`),Un(),!1):(console.log(`âœ… ë¹„ê°€ì…ì ${e} í—ˆìš©: ${r+1}/${i}`),!0)}const n=await $n(),o=e==="detail"?ue.DETAIL_CREDIT_COST:ue.SHARE_CREDIT_COST;return n<o?(console.log(`ğŸ”’ í¬ë ˆë”§ ë¶€ì¡±: ${n}/${o}`),Nn(),!1):(console.log(`âœ… í¬ë ˆë”§ ì¶©ë¶„: ${n} (í•„ìš”: ${o})`),!0)}async function jn(e="detail"){if(qt())return;if(await Le())try{const n=e==="detail"?ue.DETAIL_CREDIT_COST:ue.SHARE_CREDIT_COST,o=e==="detail"?"AI ì‘ë‹µ ìƒì„±":"ê³µìœ í˜ì´ì§€ ìƒì„±";await fetch("/api/profile/use-credits",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({amount:n,description:o})}),console.log(`ğŸ’³ í¬ë ˆë”§ ì°¨ê°: -${n} (${o})`)}catch(n){console.error("í¬ë ˆë”§ ì°¨ê° ì˜¤ë¥˜:",n)}else{Dn(e);const n=Kt();console.log(`ğŸ“Š ë¹„ê°€ì…ì ì‚¬ìš©ëŸ‰ ì—…ë°ì´íŠ¸: detail=${n.detail}, share=${n.share}`)}}let S=[],yt=!1,Ue="",vt=null,Ie=!1;async function Fn(){if(Ue)return Ue;try{return Ue=(await(await fetch("/api/config")).json()).googleMapsApiKey,Ue}catch(e){return console.error("Google Maps API í‚¤ ë¡œë“œ ì‹¤íŒ¨:",e),""}}function Wt(e){if(yt){e&&e();return}Fn().then(t=>{if(!t){console.error("Google Maps API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.");return}const n=document.createElement("script");n.src=`https://maps.googleapis.com/maps/api/js?key=${t}&libraries=places`,n.async=!0,n.defer=!0,n.onload=()=>{yt=!0,vt=new google.maps.Geocoder,console.log("ğŸ—ºï¸ Google Maps API ë¡œë“œ ì™„ë£Œ"),e&&e()},n.onerror=()=>{console.error("Google Maps API ë¡œë“œ ì‹¤íŒ¨")},document.head.appendChild(n)})}async function Jt(e,t){return console.log("ğŸ” ëœë“œë§ˆí¬ ê²€ìƒ‰ ì‹œì‘:",e,t),!yt||!window.google?(console.warn("âš ï¸ Google Mapsê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ"),null):new Promise(n=>{const o=new google.maps.Map(document.createElement("div")),a=new google.maps.places.PlacesService(o),i=new google.maps.LatLng(e,t);console.log("ğŸ” Places Nearby Search í˜¸ì¶œ (ë°˜ê²½ 100m)...");const r={location:i,radius:100,rankBy:google.maps.places.RankBy.PROMINENCE};a.nearbySearch(r,(c,d)=>{if(console.log("ğŸ“¡ Places API ì‘ë‹µ:",d),d===google.maps.places.PlacesServiceStatus.OK&&c&&c.length>0){const g=c.find(p=>p.types.includes("tourist_attraction")||p.types.includes("museum")||p.types.includes("church")||p.types.includes("park")||p.types.includes("lodging")||p.types.includes("point_of_interest"))||c[0],m=g.name;console.log("ğŸ¯ ê·¼ì²˜ ì¥ì†Œ:",m,"(íƒ€ì…:",g.types.join(", ")+")"),n(m)}else{if(console.log("ğŸ“ Places API ì‹¤íŒ¨, Geocodingìœ¼ë¡œ ì „í™˜"),!vt){console.warn("âš ï¸ Geocoder ì´ˆê¸°í™” ì•ˆ ë¨"),n(null);return}vt.geocode({location:{lat:e,lng:t}},(g,m)=>{var p;if(m==="OK"&&g[0]){const u=((p=g[0].address_components.find(b=>b.types.includes("locality")))==null?void 0:p.long_name)||g[0].formatted_address.split(",")[0];console.log("ğŸ“ ë„ì‹œ ì°¾ìŒ:",u),n(u)}else console.warn("âš ï¸ ìœ„ì¹˜ ì •ë³´ ì°¾ê¸° ì‹¤íŒ¨"),n(null)})}})})}const On="TravelGuideDB",Rn=2,Q="archive",Ne="shareLinks";let K;function Vn(){return new Promise((e,t)=>{const n=indexedDB.open(On,Rn);n.onerror=o=>t("IndexedDB error: "+o.target.errorCode),n.onsuccess=o=>{K=o.target.result,e(K)},n.onupgradeneeded=o=>{const a=o.target.result;a.objectStoreNames.contains(Q)||a.createObjectStore(Q,{keyPath:"id"}),a.objectStoreNames.contains(Ne)||a.createObjectStore(Ne,{keyPath:"id"}).createIndex("featured","featured",{unique:!1})}})}function Qt(e){return new Promise(async(t,n)=>{if(!K)return n("DB not open");const o=e.id||`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,a={...e,id:o},c=K.transaction([Q],"readwrite").objectStore(Q).add(a);c.onsuccess=()=>t(c.result),c.onerror=d=>n("Error adding item: "+d.target.error)})}function je(){return new Promise((e,t)=>{if(!K)return t("DB not open");const a=K.transaction([Q],"readonly").objectStore(Q).getAll();a.onsuccess=()=>e(a.result.reverse()),a.onerror=i=>t("Error getting items: "+i.target.error)})}function Gn(e){return new Promise((t,n)=>{if(!K)return n("DB not open");const a=K.transaction([Q],"readwrite").objectStore(Q);let i=[];e.forEach(r=>{i.push(new Promise((c,d)=>{const g=a.delete(r);g.onsuccess=c,g.onerror=d}))}),Promise.all(i).then(t).catch(n)})}function bt(e,t,n,o,a,i,r=!1,c="ko"){const d=u=>u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),g=a.map((u,b)=>`
            <div class="gallery-item" data-id="${b}">
                <img src="${u.imageDataUrl||""}" alt="ê°€ì´ë“œ ${b+1}" loading="lazy">
                <p>ê°€ì´ë“œ ${b+1}</p>
            </div>
        `).join(""),m=JSON.stringify({language:c,items:a.map((u,b)=>({id:b,imageDataUrl:u.imageDataUrl||"",description:u.description||""}))}),p=u=>btoa(encodeURIComponent(u).replace(/%([0-9A-F]{2})/g,(b,v)=>String.fromCharCode("0x"+v)));return`<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>${d(e)} - ì†ì•ˆì— ê°€ì´ë“œ</title>
    <link rel="manifest" href="data:application/json;base64,${p(JSON.stringify({name:e,short_name:e,start_url:".",display:"standalone",theme_color:"#4285F4"}))}">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            background-color: #f0f2f5;
            overflow-x: hidden;
        }
        .hidden { display: none !important; }
        
        /* ì•±ê³¼ 100% ë™ì¼í•œ CSS (ë³µì‚¬) */
        .full-screen-bg { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100vw; 
            height: 100vh; 
            object-fit: cover; 
            z-index: 1; 
        }
        .ui-layer { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: 10; 
            display: flex; 
            flex-direction: column;
        }
        .header-safe-area { 
            position: relative;
            width: 100%; 
            height: 80px; 
            flex-shrink: 0; 
            z-index: 20;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 0 1rem;
        }
        .content-safe-area { 
            flex: 1; 
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch; 
            background: transparent;
            z-index: 25;
        }
        .footer-safe-area { 
            width: 100%; 
            height: 100px; 
            flex-shrink: 0; 
            z-index: 30; 
            display: flex; 
            justify-content: space-around; 
            align-items: center; 
            padding: 0 1rem;
        }
        
        /* í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ */
        .text-content {
            padding: 2rem 1.5rem;
            line-height: 1.8;
            word-break: keep-all;
            overflow-wrap: break-word;
        }
        .readable-on-image {
            color: white;
            text-shadow: 0px 2px 8px rgba(0, 0, 0, 0.95);
        }
        
        /* ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ (ì•±ê³¼ ë™ì¼) */
        .interactive-btn {
            transition: transform 0.1s ease;
            cursor: pointer;
            border: none;
        }
        .interactive-btn:active {
            transform: scale(0.95);
        }
        
        /* í—¤ë” (ë©”íƒ€ë°ì´í„°) */
        .header {
            padding: 20px;
            background-color: #4285F4; /* Gemini Blue - ì•± í†µì¼ */
            color: #fff;
            text-align: center;
        }
        .header h1 {
            margin: 0 0 15px 0;
            font-size: 28px;
        }
        .metadata {
            font-size: 14px;
            opacity: 0.9;
        }
        .metadata p {
            margin: 5px 0;
        }
        
        /* ê°¤ëŸ¬ë¦¬ ë·° */
        #gallery-view {
            padding: 15px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        /* ë°˜ì‘í˜•: íƒœë¸”ë¦¿/ë…¸íŠ¸ë¶/PC (768px ì´ìƒ) */
        @media (min-width: 768px) {
            .gallery-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
            }
            #gallery-view {
                padding: 30px;
            }
        }
        
        .gallery-item {
            cursor: pointer;
            text-align: center;
        }
        .gallery-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            background-color: #e9e9e9;
        }
        .gallery-item:hover img {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        .gallery-item p {
            margin: 8px 0 0;
            font-weight: 700;
            color: #333;
            font-size: 14px;
        }
        
        /* ê°¤ëŸ¬ë¦¬ í•˜ë‹¨ ë²„íŠ¼ */
        .gallery-footer {
            text-align: center;
            padding: 30px 15px;
        }
        .app-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #4285F4;
            color: white;
            padding: 16px 32px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
            transition: all 0.3s;
        }
        .app-button:hover {
            background: #3367D6;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(66, 133, 244, 0.4);
        }
    </style>
</head>
<body>
    <!-- ì¹´ì¹´ì˜¤í†¡/ì¸ì•± ë¸Œë¼ìš°ì € â†’ Chrome ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸ (2025-12-02) -->
    <!-- 1ë‹¨ê³„: Intent URLë¡œ Chrome ì‹œë„, 2ë‹¨ê³„: ì‹¤íŒ¨ ì‹œ fallback URLë¡œ ìë™ ì—´ë¦¼ -->
    <script>
        (function() {
            var ua = navigator.userAgent.toLowerCase();
            var isInApp = ua.indexOf('kakaotalk') > -1 || ua.indexOf('naver') > -1 || ua.indexOf('instagram') > -1 || ua.indexOf('fb') > -1 || ua.indexOf('facebook') > -1;
            if (isInApp && /android/i.test(ua)) {
                var currentUrl = location.href;
                var url = currentUrl.replace(/^https?:\\/\\//, '');
                location.href = 'intent://' + url + '#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=' + encodeURIComponent(currentUrl) + ';end';
            }
        })();
    <\/script>
    
    <!-- âŒ X ë‹«ê¸° ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨, ìµœìƒìœ„ z-index) -->
    <button id="closeWindowBtn" onclick="window.close()" title="í˜ì´ì§€ ë‹«ê¸°" style="position: fixed; top: 1rem; right: 1rem; z-index: 10000; width: 3rem; height: 3rem; display: flex; align-items: center; justify-content: center; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px); border-radius: 50%; color: #4285F4; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); border: none;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
    </button>
    
    <!-- í—¤ë” (ë©”íƒ€ë°ì´í„°) -->
    <div class="header">
        <h1>${d(e)}</h1>
        <div class="metadata">
            <p>ğŸ‘¤ ${d(t)} ë‹˜ì´ ë³´ëƒ„</p>
            <p>ğŸ“ ${d(n)}</p>
            <p>ğŸ“… ${d(o)}</p>
        </div>
    </div>
    
    <!-- ê°¤ëŸ¬ë¦¬ ë·° -->
    <div id="gallery-view">
        ${r?`
        <!-- ğŸ”™ ì¶”ì²œ ê°¤ëŸ¬ë¦¬ ì „ìš© ë¦¬í„´ ë²„íŠ¼ (ì™¼ìª½ ìƒë‹¨, ì•±ê³¼ í†µì¼) -->
        <div style="position: sticky; top: 0; z-index: 100; height: 60px; display: flex; align-items: center; padding: 0 1rem; background: #4285F4;">
            <button onclick="window.location.href='${i}/#archive'" style="width: 3rem; height: 3rem; display: flex; align-items: center; justify-content: center; border-radius: 9999px; background: rgba(255, 255, 255, 0.95); color: #4285F4; border: none; cursor: pointer; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); transition: all 0.3s;" aria-label="ë³´ê´€í•¨ìœ¼ë¡œ ëŒì•„ê°€ê¸°">
                <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.5rem; height: 1.5rem;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
                </svg>
            </button>
        </div>
        `:""}
        <div class="gallery-grid">
            ${g}
        </div>
        <div class="gallery-footer">
            <a href="${i}" class="app-button" id="home-button">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 24px; height: 24px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
                ì†ì•ˆì— ê°€ì´ë“œ ì‹œì‘í•˜ê¸°
            </a>
        </div>
    </div>
    
    <!-- ìƒì„¸ ë·° (ì•±ê³¼ 100% ë™ì¼í•œ êµ¬ì¡°) -->
    <div id="detail-view" class="ui-layer hidden">
        <img id="detail-bg" src="" class="full-screen-bg">
        <header class="header-safe-area">
            <button id="detail-back" class="interactive-btn" style="width: 3rem; height: 3rem; display: flex; align-items: center; justify-content: center; border-radius: 9999px; background: rgba(0,0,0,0.6); backdrop-filter: blur(12px); color: #4285F4; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); position: absolute; top: 50%; left: 1rem; transform: translateY(-50%);" aria-label="ë’¤ë¡œê°€ê¸°">
                <svg xmlns="http://www.w3.org/2000/svg" style="width: 1.5rem; height: 1.5rem;" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
                </svg>
            </button>
        </header>
        <div class="content-safe-area">
            <div id="detail-text" class="text-content hidden">
                <p id="detail-description" class="readable-on-image" style="font-size: 1.25rem; line-height: 1.75rem;"></p>
            </div>
        </div>
        <footer id="detail-footer" class="footer-safe-area hidden" style="background: transparent;">
            <button id="detail-audio" class="interactive-btn" style="width: 4rem; height: 4rem; display: flex; align-items: center; justify-content: center; border-radius: 9999px; background: rgba(0,0,0,0.6); backdrop-filter: blur(12px); color: #4285F4; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);" aria-label="ì˜¤ë””ì˜¤ ì¬ìƒ">
                <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" style="width: 2rem; height: 2rem;" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.648c1.295.748 1.295 2.538 0 3.286L7.279 20.99c-1.25.717-2.779-.217-2.779-1.643V5.653z" clip-rule="evenodd" />
                </svg>
                <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" style="width: 2rem; height: 2rem; display: none;" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M6.75 5.25a.75.75 0 01.75-.75H9a.75.75 0 01.75.75v13.5a.75.75 0 01-.75.75H7.5a.75.75 0 01-.75-.75V5.25zm7.5 0A.75.75 0 0115 4.5h1.5a.75.75 0 01.75.75v13.5a.75.75 0 01-.75.75H15a.75.75 0 01-.75-.75V5.25z" clip-rule="evenodd" />
                </svg>
            </button>
            <button id="text-toggle" class="interactive-btn" style="width: 4rem; height: 4rem; display: flex; align-items: center; justify-content: center; border-radius: 9999px; background: rgba(0,0,0,0.6); backdrop-filter: blur(12px); color: #4285F4; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);" aria-label="í•´ì„¤ ì½ê¸°">
                <svg xmlns="http://www.w3.org/2000/svg" style="width: 2rem; height: 2rem;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
            </button>
            <a href="${i}" id="detail-home" class="interactive-btn" style="width: 4rem; height: 4rem; display: flex; align-items: center; justify-content: center; border-radius: 9999px; background: rgba(0,0,0,0.6); backdrop-filter: blur(12px); color: #4285F4; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); text-decoration: none;" aria-label="ì•±ìœ¼ë¡œ ì´ë™">
                <svg xmlns="http://www.w3.org/2000/svg" style="width: 2rem; height: 2rem;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
            </a>
        </footer>
    </div>
    
    <!-- ë°ì´í„° ì €ì¥ -->
    <script id="app-data" type="application/json">${m}<\/script>
    
    <script>
        // ë°ì´í„° ë¡œë“œ
        const appData = JSON.parse(document.getElementById('app-data').textContent);
        const galleryView = document.getElementById('gallery-view');
        const detailView = document.getElementById('detail-view');
        const header = document.querySelector('.header');
        
        // Web Speech API
        const synth = window.speechSynthesis;
        let voices = [];
        let currentUtterance = null;
        
        // ì–¸ì–´ ì½”ë“œ ë§¤í•‘
        const langCodeMap = {
            'ko': 'ko-KR',
            'en': 'en-US',
            'ja': 'ja-JP',
            'zh-CN': 'zh-CN',
            'fr': 'fr-FR',
            'de': 'de-DE',
            'es': 'es-ES'
        };
        
        // ì„ íƒ ì–¸ì–´ì— ë§ëŠ” ìŒì„± ì°¾ê¸° (í”Œë«í¼ë³„ ìµœì í™”)
        function getVoiceForLanguage(userLang, allVoices) {
            const langCode = langCodeMap[userLang] || 'ko-KR';
            
            // í”Œë«í¼ë³„ ìµœì  ìŒì„± ìš°ì„ ìˆœìœ„ (2025-12-07: í•œêµ­ì–´ iOS/Android ë¶„ê¸°)
            const isIOS = /iPhone|iPad|iPod|Mac/.test(navigator.userAgent);
            const voicePriority = {
                'ko-KR': isIOS ? ['Sora', 'Yuna', 'Korean', 'í•œêµ­ì–´'] : ['Microsoft Heami', 'Korean', 'í•œêµ­ì–´'],
                'en-US': ['Samantha', 'Microsoft Zira', 'Google US English', 'English'],
                'ja-JP': ['Kyoko', 'Microsoft Haruka', 'Google æ—¥æœ¬èª', 'Japanese'],
                'zh-CN': ['Ting-Ting', 'Microsoft Huihui', 'Google æ™®é€šè¯', 'Chinese'],
                'fr-FR': ['Thomas', 'Microsoft Hortense', 'Google franÃ§ais', 'French'],
                'de-DE': ['Anna', 'Microsoft Hedda', 'Google Deutsch', 'German'],
                'es-ES': ['Monica', 'Microsoft Helena', 'Google espaÃ±ol', 'Spanish']
            };
            
            let targetVoice = null;
            
            // ìš°ì„ ìˆœìœ„ëŒ€ë¡œ ìŒì„± ì°¾ê¸°
            const priorities = voicePriority[langCode] || [];
            for (const voiceName of priorities) {
                targetVoice = allVoices.find(v => v.name.includes(voiceName));
                if (targetVoice) break;
            }
            
            // ìš°ì„ ìˆœìœ„ì— ì—†ìœ¼ë©´ ì–¸ì–´ ì½”ë“œë¡œ ì°¾ê¸° (Android underscore í˜•ì‹ ëŒ€ì‘)
            if (!targetVoice) {
                const langPrefix = langCode.substring(0, 2);
                targetVoice = allVoices.find(v => 
                    v.lang.replace('_', '-').startsWith(langPrefix) && 
                    v.lang.replace('_', '-').includes(langCode.substring(3))
                );
            }
            
            // ê·¸ë˜ë„ ì—†ìœ¼ë©´ ì–¸ì–´ ì• 2ìë¦¬ë§Œ ë§¤ì¹­
            if (!targetVoice) {
                targetVoice = allVoices.find(v => v.lang.replace('_', '-').startsWith(langCode.substring(0, 2)));
            }
            
            return targetVoice;
        }
        
        function populateVoiceList() {
            const userLang = appData.language || 'ko'; // ì €ì¥ëœ ì–¸ì–´ ì‚¬ìš© (localStorage ëŒ€ì‹ )
            const allVoices = synth.getVoices();
            
            // ì„ íƒ ì–¸ì–´ì— ë§ëŠ” ìŒì„± í•„í„°ë§
            const langCode = langCodeMap[userLang] || 'ko-KR';
            voices = allVoices.filter(v => v.lang.startsWith(langCode.substring(0, 2)));
            
            console.log('ğŸ¤ [ìŒì„±ë¡œë“œ]', langCodeMap[userLang], 'ìŒì„± ê°œìˆ˜:', voices.length);
        }
        
        function stopAudio() {
            if (synth.speaking) {
                synth.pause();
                synth.cancel();
            }
            const playIcon = document.getElementById('play-icon');
            const pauseIcon = document.getElementById('pause-icon');
            if (playIcon) playIcon.style.display = 'block';
            if (pauseIcon) pauseIcon.style.display = 'none';
        }
        
        async function playAudio(text) {
            stopAudio();
            
            // ğŸŒ êµ¬ê¸€ ë²ˆì—­ ì™„ë£Œ ëŒ€ê¸° (ë²ˆì—­ëœ í…ìŠ¤íŠ¸ë¡œ TTS ì¬ìƒ)
            await waitForTranslation();
            
            // âš ï¸ **í•µì‹¬ ë¡œì§ - ì ˆëŒ€ ìˆ˜ì • ê¸ˆì§€!** (2025-10-03 ì¹˜ëª…ì  ë²„ê·¸ í•´ê²°)
            // 
            // ë¬¸ì œ: HTML ë‚´ë¶€ JavaScriptì—ì„œ ì •ê·œì‹ /<brs*/?>/gi ì‚¬ìš© ì‹œ
            //       HTML íŒŒì„œê°€ < > ë¥¼ &lt; &gt; ë¡œ ë³€í™˜í•˜ì—¬ JavaScript íŒŒì‹± ì—ëŸ¬ ë°œìƒ
            //       â†’ "Uncaught SyntaxError: Unexpected token '&'" 
            //
            // í•´ê²°: new RegExp() ë°©ì‹ìœ¼ë¡œ HTML íŒŒì„œì™€ 100% ë¶„ë¦¬
            //       - ì•ˆì „ì„±: HTML escape ë¬¸ì œ ì›ì²œ ì°¨ë‹¨
            //       - í˜¸í™˜ì„±: ëª¨ë“  ë¸Œë¼ìš°ì € ì§€ì›
            //       - ì˜êµ¬ì„±: ì•ìœ¼ë¡œ ì ˆëŒ€ ê¹¨ì§€ì§€ ì•ŠìŒ
            //
            // ì˜í–¥: 27ê°œ ê¸°ì¡´ ê³µìœ  í˜ì´ì§€ DB ì¼ê´„ ì—…ë°ì´íŠ¸ ì™„ë£Œ (2025-10-03)
            const cleanText = text.replace(new RegExp('<br\\s*/?>', 'gi'), ' ');
            
            // ë¬¸ì¥ ë¶„ë¦¬ ë° í•˜ì´ë¼ì´íŠ¸ ì¤€ë¹„
            const sentences = cleanText.match(/[^.!?]+[.!?]+/g) || [cleanText];
            const textElement = document.getElementById('detail-description');
            
            // ì›ë³¸ í…ìŠ¤íŠ¸ ì €ì¥
            const originalText = cleanText;
            
            currentUtterance = new SpeechSynthesisUtterance(cleanText);
            
            // ì„ íƒ ì–¸ì–´ì— ë§ëŠ” ìŒì„± ìë™ ì„ íƒ (ì €ì¥ëœ ì–¸ì–´ ì‚¬ìš©)
            const userLang = appData.language || 'ko';
            const langCode = langCodeMap[userLang] || 'ko-KR';
            
            // ëª¨ë“  ì–¸ì–´ì— ëŒ€í•´ voicePriorityì—ì„œ ìŒì„± ì„ íƒ
            const targetVoice = getVoiceForLanguage(userLang, synth.getVoices());
            currentUtterance.voice = targetVoice;
            currentUtterance.lang = langCode;
            currentUtterance.rate = 1.0;
            console.log('ğŸ¤ [ìŒì„±ì¬ìƒ]', langCode, 'ìŒì„±:', targetVoice?.name || 'default');
            
            const playIcon = document.getElementById('play-icon');
            const pauseIcon = document.getElementById('pause-icon');
            
            let currentSentenceIndex = 0;
            
            currentUtterance.onstart = () => {
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'block';
            };
            
            // ë‹¨ì–´ ê²½ê³„ë§ˆë‹¤ í•˜ì´ë¼ì´íŠ¸
            currentUtterance.onboundary = (event) => {
                if (event.name === 'sentence') {
                    // í˜„ì¬ ë¬¸ì¥ í•˜ì´ë¼ì´íŠ¸
                    const highlightedHTML = sentences.map((sentence, idx) => {
                        if (idx === currentSentenceIndex) {
                            return '<span style="background-color: rgba(66, 133, 244, 0.3); font-weight: 600;">' + sentence + '</span>';
                        }
                        return sentence;
                    }).join('');
                    
                    textElement.innerHTML = highlightedHTML;
                    currentSentenceIndex++;
                }
            };
            
            currentUtterance.onend = () => {
                playIcon.style.display = 'block';
                pauseIcon.style.display = 'none';
                // í•˜ì´ë¼ì´íŠ¸ ì œê±°, ì›ë³¸ ë³µì›
                textElement.textContent = originalText;
            };
            
            synth.speak(currentUtterance);
        }
        
        populateVoiceList();
        if (synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = populateVoiceList;
        }
        
        // ê°¤ëŸ¬ë¦¬ ì•„ì´í…œ í´ë¦­ (ì•±ê³¼ 100% ë™ì¼í•œ ë¡œì§)
        document.querySelectorAll('.gallery-item').forEach(item => {
            item.addEventListener('click', () => {
                const itemData = appData.items[parseInt(item.dataset.id)];
                
                // ë°°ê²½ ì´ë¯¸ì§€ ì„¤ì •
                document.getElementById('detail-bg').src = itemData.imageDataUrl;
                
                // í…ìŠ¤íŠ¸ ì„¤ì •
                document.getElementById('detail-description').textContent = itemData.description;
                
                // UI í‘œì‹œ
                galleryView.classList.add('hidden');
                header.classList.add('hidden');
                detailView.classList.remove('hidden');
                document.getElementById('detail-footer').classList.remove('hidden');
                
                // í…ìŠ¤íŠ¸ëŠ” í‘œì‹œ ìƒíƒœë¡œ ì‹œì‘ (ìŒì„±ê³¼ ë™ì‹œì— ë³´ì„)
                document.getElementById('detail-text').classList.remove('hidden');
                
                // ìŒì„± ìë™ ì¬ìƒ
                playAudio(itemData.description);
            });
        });
        
        // ğŸ”™ ë³´ê´€í•¨ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ (ê°¤ëŸ¬ë¦¬ ë·°)
        const galleryBackBtn = document.getElementById('gallery-back-btn');
        if (galleryBackBtn) {
            galleryBackBtn.addEventListener('click', () => {
                window.location.href = '/#archive';
            });
        }
        
        // ë’¤ë¡œ ê°€ê¸°
        document.getElementById('detail-back').addEventListener('click', () => {
            stopAudio();
            detailView.classList.add('hidden');
            document.getElementById('detail-text').classList.add('hidden');
            document.getElementById('detail-footer').classList.add('hidden');
            header.classList.remove('hidden');
            galleryView.classList.remove('hidden');
        });
        
        // í…ìŠ¤íŠ¸ í† ê¸€ ë²„íŠ¼ (ì•±ê³¼ ë™ì¼í•œ ë¡œì§)
        document.getElementById('text-toggle')?.addEventListener('click', () => {
            document.getElementById('detail-text').classList.toggle('hidden');
        });
        
        // ìŒì„± ì¬ìƒ/ì •ì§€
        document.getElementById('detail-audio').addEventListener('click', () => {
            if (synth.speaking) {
                stopAudio();
            } else {
                const text = document.getElementById('detail-description').textContent;
                playAudio(text);
            }
        });
        
        // í™ˆ ë²„íŠ¼ (ê°¤ëŸ¬ë¦¬ í•˜ë‹¨)
        const homeButton = document.getElementById('home-button');
        if (homeButton) {
            homeButton.addEventListener('click', (e) => {
                e.preventDefault();
                stopAudio();
                setTimeout(() => {
                    window.location.href = homeButton.href;
                }, 200);
            });
        }
        
        // í™ˆ ë²„íŠ¼ (ìƒì„¸ ë·° í•˜ë‹¨) - ìŒì„± ë“£ë‹¤ê°€ ë°”ë¡œ ì•±ìœ¼ë¡œ ê°€ê¸°
        const detailHome = document.getElementById('detail-home');
        if (detailHome) {
            detailHome.addEventListener('click', (e) => {
                e.preventDefault();
                stopAudio();
                setTimeout(() => {
                    window.location.href = detailHome.href;
                }, 200);
            });
        }
        
        // í˜ì´ì§€ ì´íƒˆ ì‹œ ì˜¤ë””ì˜¤ ì •ì§€ (ë°±ê·¸ë¼ìš´ë“œ ì¬ìƒ ë°©ì§€)
        window.addEventListener('beforeunload', () => {
            stopAudio();
        });
    <\/script>
    
    <!-- âš ï¸ í•µì‹¬ ë¡œì§: Service Worker ë“±ë¡ (ì˜¤í”„ë¼ì¸ ì§€ì›) -->
    <script>
        // Service Worker ì§€ì› í™•ì¸ ë° ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw-share.js')
                    .then(registration => {
                        console.log('âœ… [SW] ë“±ë¡ ì„±ê³µ:', registration.scope);
                    })
                    .catch(error => {
                        console.log('âŒ [SW] ë“±ë¡ ì‹¤íŒ¨:', error);
                    });
            });
        } else {
            console.log('âš ï¸ [SW] Service Workerë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
        }
    <\/script>
</body>
</html>`}function Hn(e,t){const n=new Blob([t],{type:"text/html;charset=utf-8"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}window.downloadFeaturedHTML=async function(e){try{const o=K.transaction([Ne],"readonly").objectStore(Ne).get(e);o.onsuccess=()=>{const a=o.result;if(a){const i=window.location.origin,r=localStorage.getItem("appLanguage")||"ko",c=bt(a.title,a.sender,a.location,a.date,a.guideItems,i,!1,r);Hn(`${a.title}-ì†ì•ˆì—ê°€ì´ë“œ.html`,c),s("ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.")}}}catch(t){console.error("Download error:",t),s("ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}};function s(e,t=3e3){if(!B)return;const n=document.createElement("div");n.className="toast-notification",n.textContent=e,B.appendChild(n),requestAnimationFrame(()=>{n.classList.add("show")}),setTimeout(()=>{n.classList.remove("show"),n.addEventListener("transitionend",()=>{n.remove()})},t)}function ge(e){[Ce,X,W,Pt,At,Rt].forEach(t=>{t&&t.classList.toggle("visible",t===e)})}function xt(){Ie=!1,k.cancel(),me(),ge(X),W.classList.remove("bg-friendly"),Dt.classList.add("hidden"),Ln.classList.remove("hidden");const e=localStorage.getItem("cameraWasActive")==="true";O&&!Ae?tn():!O&&e&&(console.log("ğŸ”„ Restoring camera after Featured page visit"),en())}function kt(e=!1){Oe(),ge(W),ee.disabled=e}async function Ee(){Oe(),k.cancel(),me(),U&&se(!1),ge(Pt),Se()}async function Lt(){Oe(),mo(),ho(),ge(At)}function me(){k.cancel(),De=[],$e=!1,ae=!1,z&&z.classList.remove("speaking"),z=null}let It=null;async function _n(){try{const e=await fetch("/api/notifications/unread-count",{credentials:"include"});return e.ok&&(await e.json()).count||0}catch(e){return console.warn("ì•Œë¦¼ ìˆ˜ ì¡°íšŒ ì‹¤íŒ¨:",e),0}}async function Et(){const e=await _n();de&&(e>0?(de.textContent=e>99?"99+":e,de.classList.remove("hidden")):de.classList.add("hidden"))}async function Xt(){try{const e=await fetch("/api/notifications",{credentials:"include"});return e.ok?await e.json():[]}catch(e){return console.warn("ì•Œë¦¼ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:",e),[]}}function Yt(e){if(!(!be||!rt)){if(e.length===0){be.classList.add("hidden"),rt.classList.remove("hidden");return}be.classList.remove("hidden"),rt.classList.add("hidden"),be.innerHTML=e.map(t=>{const n=t.isRead,o=Kn(new Date(t.createdAt)),a=zn(t.type);return`
                <div class="notification-item flex items-start gap-3 p-3 rounded-lg ${n?"opacity-60":"bg-blue-50/50"}"
                     data-notification-id="${t.id}"
                     data-testid="notification-item-${t.id}">
                    <div class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                        ${a}
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-gray-900 ${n?"":"font-semibold"}">${t.title}</p>
                        <p class="text-sm text-gray-600 truncate">${t.body||""}</p>
                        <p class="text-xs text-gray-400 mt-1">${o}</p>
                    </div>
                    <button class="notification-delete-btn flex-shrink-0 p-1 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition"
                            data-notification-id="${t.id}"
                            data-testid="button-delete-notification-${t.id}">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `}).join(""),be.querySelectorAll(".notification-delete-btn").forEach(t=>{t.addEventListener("click",async n=>{n.stopPropagation();const o=parseInt(t.dataset.notificationId);await qn(o),Et();const a=await Xt();Yt(a)})})}}function zn(e){switch(e){case"reward":return'<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';case"system":return'<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';case"new_content":return'<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"></path></svg>';case"event":return'<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg>';case"urgent":return'<svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>';default:return'<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>'}}function Kn(e){const n=new Date-e,o=Math.floor(n/1e3),a=Math.floor(o/60),i=Math.floor(a/60),r=Math.floor(i/24);return o<60?"ë°©ê¸ˆ ì „":a<60?`${a}ë¶„ ì „`:i<24?`${i}ì‹œê°„ ì „`:r<7?`${r}ì¼ ì „`:e.toLocaleDateString("ko-KR")}async function qn(e){try{await fetch(`/api/notifications/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"})}catch(t){console.warn("ì•Œë¦¼ ì‚­ì œ ì‹¤íŒ¨:",t)}}async function Wn(){if(!J)return;J.classList.remove("hidden");const e=await Xt();Yt(e)}async function Zt(){if(J){J.classList.add("hidden"),Ot=!1;try{await fetch("/api/notifications/mark-read",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"}),de&&de.classList.add("hidden")}catch(e){console.warn("ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ ì‹¤íŒ¨:",e)}}}function Jn(){Et(),It&&clearInterval(It),It=setInterval(()=>{Et()},3e4)}ct==null||ct.addEventListener("click",Zt),J==null||J.addEventListener("click",e=>{e.target===J&&Zt()}),Qe==null||Qe.addEventListener("click",async()=>{if(!await Le()){window.open("/profile.html","_blank");return}try{((await(await fetch("/api/notifications/unread-count",{credentials:"include"})).json()).count||0)>0?(Ot=!0,Wn()):window.open("/profile.html","_blank")}catch(t){console.warn("ì•Œë¦¼ ìˆ˜ í™•ì¸ ì‹¤íŒ¨:",t),window.open("/profile.html","_blank")}});async function Qn(){try{await An(),await Vn()}catch(n){console.error("Failed to open database",n),s("ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì•±ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")}new URLSearchParams(window.location.search).get("auth")==="failed"&&(console.error("âŒ OAuth ì¸ì¦ ì‹¤íŒ¨ ê°ì§€"),s("ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."),window.history.replaceState({},"",window.location.pathname+window.location.hash),localStorage.removeItem("pendingShareUrl")),console.log("ğŸ” Checking for pending share URL...");const t=localStorage.getItem("pendingShareUrl");console.log("ğŸ“¦ localStorage.pendingShareUrl:",t),t?(console.log("ğŸ¯ Opening pending share URL after auth:",t),localStorage.removeItem("pendingShareUrl"),console.log("ğŸ—‘ï¸ Removed from localStorage"),setTimeout(()=>{console.log("ğŸš€ Opening page in new window:",t),window.open(t,"_blank")},500)):console.log("âŒ No pending URL found"),window.location.hash==="#archive"&&(console.log("ğŸ“ Direct archive access detected"),Ee()),F&&(F.continuous=!1,F.lang="ko-KR",F.interimResults=!1,F.maxAlternatives=1),Fe(),window.addEventListener("focus",Fe),window.addEventListener("visibilitychange",()=>{document.hidden||Fe()}),window.addEventListener("message",n=>{if(n.origin!==window.location.origin){console.warn("âš ï¸ Unauthorized message origin:",n.origin);return}if(n.data.type==="oauth_success"){console.log("âœ… OAuth íŒì—… ì„±ê³µ ë©”ì‹œì§€ ìˆ˜ì‹ !"),l==null||l.classList.add("hidden"),l==null||l.classList.add("pointer-events-none"),l==null||l.classList.remove("pointer-events-auto");const o=localStorage.getItem("pendingShareUrl");o?(console.log("ğŸ¯ Opening pending URL in new window:",o),localStorage.removeItem("pendingShareUrl"),window.open(o,"_blank")):(console.log("ğŸ”„ Refreshing Featured Gallery"),an())}}),window.addEventListener("storage",n=>{n.key==="auth_success"&&n.newValue==="true"&&(console.log("ğŸ”” Storage ì´ë²¤íŠ¸ ê°ì§€: auth_success = true"),Fe())}),Jn()}async function Fe(){if(console.log("ğŸŸ¡ Checking auth status..."),localStorage.getItem("auth_success")==="true"){console.log("âœ… OAuth ì¸ì¦ ì„±ê³µ í”Œë˜ê·¸ ê°ì§€!"),l==null||l.classList.add("hidden"),l==null||l.classList.add("pointer-events-none"),l==null||l.classList.remove("pointer-events-auto"),localStorage.removeItem("auth_success"),console.log("âœ… Auth modal closed - OAuth redirect successful");const t=localStorage.getItem("pendingShareUrl");t&&(console.log("ğŸ¯ Opening pending share URL in new window:",t),localStorage.removeItem("pendingShareUrl"),window.open(t,"_blank"));return}try{const t=await fetch("/api/auth/user");if(console.log("ğŸŸ¡ Auth response:",t.ok,t.status),t.ok){console.log("ğŸŸ¡ Modal element:",l),l==null||l.classList.add("hidden"),l==null||l.classList.add("pointer-events-none"),l==null||l.classList.remove("pointer-events-auto"),console.log("âœ… Auth modal closed - user is authenticated");const n=localStorage.getItem("pendingShareUrl");n&&(console.log("ğŸ¯ Opening pending share URL in new window:",n),localStorage.removeItem("pendingShareUrl"),window.open(n,"_blank"))}else console.log("âšª Not authenticated, keeping modal state")}catch(t){console.log("âš ï¸ Auth check error:",t)}}async function en(){if(ge(X),Dt.classList.add("hidden"),k&&!k.speaking){const e=new SpeechSynthesisUtterance("");k.speak(e),k.cancel()}$t.classList.remove("hidden");try{O?tn():(await Xn(),localStorage.setItem("cameraWasActive","true"))}catch(e){console.error(`Initialization error: ${e.message}`),console.log("âš ï¸ ì¹´ë©”ë¼ ì´ˆê¸°í™” ì‹¤íŒ¨, ì—…ë¡œë“œ ê¸°ëŠ¥ì€ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤."),s("ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì—…ë¡œë“œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.")}finally{$t.classList.add("hidden")}}function Xn(){return new Promise(async(e,t)=>{if(O&&O.getTracks().forEach(i=>i.stop()),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){const i=new Error("ì¹´ë©”ë¼ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");return t(i)}const n={video:{facingMode:{ideal:"environment"}},audio:!1},o={video:!0,audio:!1};let a;try{a=await navigator.mediaDevices.getUserMedia(n)}catch(i){console.warn("Could not get camera with ideal constraints, falling back to basic.",i);try{a=await navigator.mediaDevices.getUserMedia(o)}catch(r){return t(r)}}O=a,x.srcObject=O,x.play().catch(i=>console.error("Video play failed:",i)),x.onloadedmetadata=()=>{[fe,we,ce].forEach(i=>{i&&(i.disabled=!1)}),Ae=!0,e()},x.onerror=i=>t(new Error("Failed to load video stream."))})}function Oe(){O&&(O.getTracks().forEach(e=>e.enabled=!1),Ae=!1,localStorage.setItem("cameraWasActive","false"))}function tn(){O&&(O.getTracks().forEach(e=>e.enabled=!0),Ae=!0,x.play().catch(e=>console.error("Video resume play failed:",e)),localStorage.setItem("cameraWasActive","true"))}async function Yn(){if(!x.videoWidth||!x.videoHeight||!await wt("detail"))return;f.width=x.videoWidth,f.height=x.videoHeight;const t=f.getContext("2d");t&&(t.drawImage(x,0,0,f.width,f.height),Re(),nn(f.toDataURL("image/jpeg"),fe))}async function Re(){if(!navigator.geolocation){console.warn("âš ï¸ ë¸Œë¼ìš°ì €ê°€ ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤");return}try{const e=await new Promise((o,a)=>{navigator.geolocation.getCurrentPosition(o,a,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}),t=e.coords.latitude,n=e.coords.longitude;window.currentGPS={latitude:t,longitude:n,locationName:null},console.log("ğŸ“ ë¸Œë¼ìš°ì € ìœ„ì¹˜ ì¶”ì¶œ ì„±ê³µ:",window.currentGPS),Wt(async()=>{console.log("ğŸ—ºï¸ callback ì‹¤í–‰ë¨ (ë¸Œë¼ìš°ì € GPS)");const o=await Jt(t,n);console.log("ğŸ” ëœë“œë§ˆí¬ ê²€ìƒ‰ ê²°ê³¼:",o),o&&(window.currentGPS.locationName=o,console.log("âœ… ìœ„ì¹˜ ì´ë¦„ ì €ì¥ ì™„ë£Œ:",o))})}catch(e){e.code===1?console.log("â„¹ï¸ ì‚¬ìš©ìê°€ ìœ„ì¹˜ ê¶Œí•œì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤"):console.error("ìœ„ì¹˜ ì •ë³´ ì˜¤ë¥˜:",e),window.currentGPS=null}}async function Zn(e){var n;const t=(n=e.target.files)==null?void 0:n[0];if(t){if(!await wt("detail")){e.target.value="";return}try{if(window.exifr){const i=await exifr.gps(t);i&&i.latitude&&i.longitude?(window.currentGPS={latitude:i.latitude,longitude:i.longitude,locationName:null},console.log("ğŸ“ EXIF GPS ì¶”ì¶œ ì„±ê³µ:",window.currentGPS),Wt(async()=>{console.log("ğŸ—ºï¸ callback ì‹¤í–‰ë¨ (EXIF GPS)");const r=await Jt(i.latitude,i.longitude);console.log("ğŸ” ëœë“œë§ˆí¬ ê²€ìƒ‰ ê²°ê³¼:",r),r&&(window.currentGPS.locationName=r,console.log("âœ… ìœ„ì¹˜ ì´ë¦„ ì €ì¥ ì™„ë£Œ:",r))})):(console.log("â„¹ï¸ EXIF GPS ì •ë³´ ì—†ìŒ â†’ ë¸Œë¼ìš°ì € ìœ„ì¹˜ ìš”ì²­"),window.currentGPS=null,Re())}else console.warn("âš ï¸ exifr ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì‹¤íŒ¨ â†’ ë¸Œë¼ìš°ì € ìœ„ì¹˜ ìš”ì²­"),window.currentGPS=null,Re()}catch(i){console.error("GPS ì¶”ì¶œ ì˜¤ë¥˜:",i),window.currentGPS=null,Re()}const a=new FileReader;a.onload=i=>{var r;return nn((r=i.target)==null?void 0:r.result,we)},a.readAsDataURL(t)}e.target.value=""}async function nn(e,t){t.disabled=!0,Ie=!1,(k.speaking||k.pending)&&k.cancel(),me(),kt(),y={imageDataUrl:e,description:""},Y.src=e,Y.classList.remove("hidden"),le.classList.remove("hidden"),P.classList.add("hidden"),P.classList.remove("animate-in"),Z.classList.remove("hidden"),Ut.textContent="í•´ì„¤ ì¤€ë¹„ ì¤‘...",ye.classList.add("hidden"),N.innerHTML="",_("loading");const n=["ì‚¬ì§„ ì† ì´ì•¼ê¸°ë¥¼ ì°¾ì•„ë‚´ê³  ìˆì–´ìš”...","ê³§ ì¬ë¯¸ìˆëŠ” ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ë“œë¦´ê²Œìš”!"];let o=0;Te.innerText=n[o];const a=window.setInterval(()=>{o=(o+1)%n.length,Te.innerText=n[o]},2e3);try{const i=await To(e),r=i.split(",")[1];y.imageDataUrl=i;const c=Bo(r);clearInterval(a),le.classList.add("hidden"),P.classList.remove("hidden"),P.classList.add("animate-in"),Z.classList.add("hidden"),ye.classList.remove("hidden");let d="";for await(const g of c){const m=g.text;if(m){y.description+=m,d+=m;const p=/[.?!]/g;let u;for(;(u=p.exec(d))!==null;){const b=d.substring(0,u.index+1).trim();if(d=d.substring(u.index+1),b){const v=document.createElement("span");v.textContent=b+" ",N.appendChild(v),pe(b,v)}}}}if(d.trim()){const g=d.trim(),m=document.createElement("span");m.textContent=g+" ",N.appendChild(m),pe(g,m)}await jn("detail")}catch(i){console.error("ë¶„ì„ ì˜¤ë¥˜:",i),clearInterval(a),le.classList.add("hidden"),Z.classList.add("hidden"),P.classList.remove("hidden");let r="ì´ë¯¸ì§€ í•´ì„¤ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";N.innerText=r,_("disabled")}finally{t.disabled=!1}}async function eo(){if(!F)return s("ìŒì„± ì¸ì‹ì´ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");if(pt)return F.stop();await wt("detail")&&(pt=!0,ce.classList.add("mic-listening"),F.start(),F.onresult=t=>{to(t.results[0][0].transcript)},F.onerror=t=>{console.error("Speech recognition error:",t.error),s({"no-speech":"ìŒì„±ì„ ë“£ì§€ ëª»í–ˆì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ë³¼ê¹Œìš”?","not-allowed":"ë§ˆì´í¬ ì‚¬ìš© ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.","service-not-allowed":"ë§ˆì´í¬ ì‚¬ìš© ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤."}[t.error]||"ìŒì„± ì¸ì‹ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")},F.onend=()=>{pt=!1,ce.classList.remove("mic-listening")})}async function to(e){Ie=!1,(k.speaking||k.pending)&&k.cancel(),me(),kt(),W.classList.add("bg-friendly"),ee.disabled=!0,y={imageDataUrl:null,description:""},Y.src="",Y.classList.add("hidden"),le.classList.remove("hidden"),P.classList.add("hidden"),P.classList.remove("animate-in"),Z.classList.remove("hidden"),Ut.textContent="ë‹µë³€ ì¤€ë¹„ ì¤‘...",ye.classList.add("hidden"),N.innerHTML="",_("loading");const t=["ì–´ë–¤ ì§ˆë¬¸ì¸ì§€ ì‚´í´ë³´ê³  ìˆì–´ìš”...","ì¹œì ˆí•œ ë‹µë³€ì„ ì¤€ë¹„í•˜ê³  ìˆì–´ìš”!"];let n=0;Te.innerText=t[n];const o=window.setInterval(()=>{n=(n+1)%t.length,Te.innerText=t[n]},2e3);try{const a=Co(e);clearInterval(o),le.classList.add("hidden"),P.classList.remove("hidden"),P.classList.add("animate-in"),Z.classList.add("hidden"),ye.classList.remove("hidden");let i="";for await(const r of a){const c=r.text;if(c){y.description+=c,i+=c;const d=/[.?!]/g;let g;for(;(g=d.exec(i))!==null;){const m=i.substring(0,g.index+1).trim();if(i=i.substring(g.index+1),m){const p=document.createElement("span");p.textContent=m+" ",N.appendChild(p),pe(m,p)}}}}if(i.trim()){const r=i.trim(),c=document.createElement("span");c.textContent=r+" ",N.appendChild(c),pe(r,c)}}catch(a){console.error("ë‹µë³€ ì˜¤ë¥˜:",a),clearInterval(o),P.classList.remove("hidden"),N.innerText="ë‹µë³€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.",_("disabled")}}function no(){const e=localStorage.getItem("appLanguage")||"ko",n={ko:"ko-KR",en:"en-US",ja:"ja-JP","zh-CN":"zh-CN",fr:"fr-FR",de:"de-DE",es:"es-ES"}[e]||"ko-KR";let o=null;const a=Ht(n),i=a.priorities,r=a.excludeVoices,c=k.getVoices();for(const d of i){const g=c.find(m=>m.name.includes(d)&&!r.some(p=>m.name.includes(p)));if(g){o=g.name;break}}return!o&&i.length>0&&(o=i[0],console.log("ğŸ¤ [ìŒì„±] getVoices() ë¹ˆ ë°°ì—´ â†’ ê¸°ë³¸ê°’ ì‚¬ìš©:",o)),{voiceLang:n,voiceName:o}}async function oo(){var e,t;if(!(!y.description||!y.imageDataUrl)){ee.disabled=!0;try{window.currentGPS&&(y.latitude=window.currentGPS.latitude,y.longitude=window.currentGPS.longitude,y.locationName=window.currentGPS.locationName,console.log("ğŸ“ GPS ë°ì´í„° ì €ì¥:",window.currentGPS));const n=no();y.voiceLang=n.voiceLang,y.voiceName=n.voiceName,console.log("ğŸ¤ ìŒì„± ì •ë³´ ì €ì¥:",n);const o=await Qt(y);s("ë³´ê´€í•¨ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");try{console.log("ğŸ“¦ guides DB ì €ì¥ ì‹œì‘...");const a=localStorage.getItem("appLanguage")||"ko",i=await fetch("/api/guides/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({language:a,guides:[{localId:o,title:y.title||"ì œëª© ì—†ìŒ",description:y.description,imageDataUrl:y.imageDataUrl,latitude:(e=y.latitude)==null?void 0:e.toString(),longitude:(t=y.longitude)==null?void 0:t.toString(),locationName:y.locationName,aiGeneratedContent:y.description,voiceLang:n.voiceLang,voiceName:n.voiceName}]})});if(i.ok){const r=await i.json();console.log(`âœ… guides DB ì €ì¥ ì™„ë£Œ: ${r.success}/${r.total}ê°œ`)}else console.warn("âš ï¸ guides DB ì €ì¥ ì‹¤íŒ¨ (ì¸ì¦ í•„ìš” ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜)")}catch(a){console.error("âš ï¸ guides DB ì €ì¥ ì˜¤ë¥˜ (IndexedDBëŠ” ì €ì¥ë¨):",a)}window.currentGPS=null}catch(n){console.error("Failed to save to archive:",n),s("ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."),ee.disabled=!1}}}function se(e){typeof e=="boolean"?U=e:U=!U;const t=document.getElementById("downloadSelectedBtnContainer");console.log("ğŸ”µ [Selection Mode] Toggling:",U),console.log("ğŸ”µ [Selection Mode] Download container exists:",!!t),U?(D.classList.add("selection-mode"),jt.classList.add("hidden"),Ft.classList.remove("hidden"),t==null||t.classList.remove("hidden"),console.log("âœ… [Selection Mode] Download button shown"),S=[],on()):(D.classList.remove("selection-mode"),jt.classList.remove("hidden"),Ft.classList.add("hidden"),t==null||t.classList.add("hidden"),console.log("âŒ [Selection Mode] Download button hidden"),S=[],document.querySelectorAll(".archive-item").forEach(n=>{n.classList.remove("selected")}))}function on(){En.textContent=`${S.length}ê°œ ì„ íƒ`;const e=document.getElementById("downloadSelectedBtn");e&&(S.length>0?(e.disabled=!1,e.classList.remove("opacity-50","cursor-not-allowed")):(e.disabled=!0,e.classList.add("opacity-50","cursor-not-allowed")))}async function ao(){if(S.length!==0&&confirm(`ì„ íƒëœ ${S.length}ê°œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))try{await Gn([...S]),await Se(),se(!1),s(`${S.length}ê°œ í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`)}catch(e){console.error("Failed to delete items:",e),s("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}let he=[];async function io(){const e=await je();if(e.length===0)return s("ê³µìœ í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.");const t=U&&S.length>0?S.map(n=>e.find(o=>o.id===n)).filter(Boolean):e;if(t.length===0)return s("ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.");if(t.length>20)return s("í•œ ë²ˆì— ìµœëŒ€ 20ê°œê¹Œì§€ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„ íƒì„ ì¤„ì—¬ì£¼ì„¸ìš”.");he=t,St(),h.classList.remove("hidden")}function St(){w.innerHTML=`
            <!-- í—¤ë” -->
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-xl font-bold text-gray-800">ê³µìœ  ë§í¬ ìƒì„±</h2>
                <button id="closeShareModalBtn" data-testid="button-close-share-modal" class="p-2 text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button>
            </div>
            
            <!-- í¼ -->
            <div class="p-6 space-y-6">
                <!-- ë§í¬ ì´ë¦„ ì…ë ¥ (í•„ìˆ˜) -->
                <div>
                    <label for="shareLinkName" class="block text-sm font-medium text-gray-700 mb-2">
                        ë§í¬ ì´ë¦„ <span class="text-red-500">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="shareLinkName" 
                        data-testid="input-share-link-name"
                        placeholder="ì˜ˆ: ë‚´ê°€ ë§›ë³¸ íŒŒë¦¬ ìµœì•…ì˜ ìŒì‹ë“¤"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        maxlength="50"
                    >
                    <p class="text-xs text-gray-500 mt-1">ì‚¬ìš©ìì˜ ì°½ì˜ë ¥ì„ ë°œíœ˜í•´ë³´ì„¸ìš”!</p>
                </div>
                
                <!-- ë§í¬ ë³µì‚¬ ë²„íŠ¼ -->
                <div>
                    <button 
                        id="copyShareLinkBtn" 
                        data-testid="button-copy-share-link"
                        class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-4 px-6 rounded-xl hover:from-blue-600 hover:to-blue-700 transition duration-300 shadow-lg flex items-center justify-center gap-3"
                    >
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                        </svg>
                        <span>ë§í¬ ë³µì‚¬í•˜ê¸°</span>
                    </button>
                    <p class="text-xs text-gray-500 mt-2 text-center">ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ ì›í•˜ëŠ” ê³³ì— ê³µìœ í•˜ì„¸ìš”</p>
                </div>
            </div>
        `;const e=document.getElementById("closeShareModalBtn"),t=document.getElementById("copyShareLinkBtn");e&&(e.onclick=()=>{h.classList.add("hidden")}),t&&(t.onclick=()=>so()),h.addEventListener("click",n=>{n.target===h&&h.classList.add("hidden")})}async function so(){var t,n;const e=document.getElementById("shareLinkName").value.trim();if(!e)return s("ë§í¬ ì´ë¦„ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”!");w.innerHTML=`
            <div class="p-6 text-center">
                <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                <p class="text-lg font-semibold">ë§í¬ ìƒì„± ì¤‘...</p>
            </div>
        `;try{const o=new Date().toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"});let a="ì—¬í–‰ì",i="íŒŒë¦¬, í”„ë‘ìŠ¤";try{const v=await fetch("/api/auth/user");if(v.ok){const T=await v.json();T.firstName?a=`${T.firstName}${T.lastName?" "+T.lastName:""}`.trim():T.email&&(a=T.email.split("@")[0])}}catch(v){console.warn("ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:",v)}(t=he[0])!=null&&t.locationName&&(i=he[0].locationName);const r=window.location.origin,c=localStorage.getItem("appLanguage")||"ko",d=bt(e,a,i,o,he,r,!1,c),g={name:e,htmlContent:d,guideIds:he.map(v=>v.id),thumbnail:((n=he[0])==null?void 0:n.imageDataUrl)||null,featured:!1},m=await fetch("/api/share/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(!m.ok){const v=await m.json();throw new Error(v.error||"ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}const p=await m.json(),u=`${window.location.origin}/s/${p.id}`;let b=!1;try{await navigator.clipboard.writeText(u),b=!0}catch(v){console.warn("í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨ (ê¶Œí•œ ì—†ìŒ):",v)}U&&se(!1),await Se(),w.innerHTML=`
                <div class="p-8 text-center">
                    <div class="w-20 h-20 mx-auto mb-6 bg-green-100 rounded-full flex items-center justify-center">
                        <svg class="w-12 h-12 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-4">ë§í¬ ìƒì„± ì™„ë£Œ!</h3>
                    ${b?`
                        <p class="text-lg text-gray-700 mb-3">âœ… ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤</p>
                        <p class="text-base text-gray-600">ì¹´ì¹´ì˜¤í†¡, ë¬¸ì, ë©”ì‹ ì € ë“±<br>ì›í•˜ëŠ” ê³³ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”!</p>
                    `:`
                        <p class="text-base text-gray-700 mb-4">ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ ê³µìœ í•˜ì„¸ìš”:</p>
                        <div class="bg-gray-100 p-4 rounded-lg mb-3">
                            <p class="text-sm font-mono text-gray-800 break-all">${u}</p>
                        </div>
                        <button onclick="navigator.clipboard.writeText('${u}').then(() => alert('ë³µì‚¬ ì™„ë£Œ!'))" 
                                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            ë§í¬ ë³µì‚¬í•˜ê¸°
                        </button>
                    `}
                </div>
            `,setTimeout(()=>{h.classList.add("hidden")},3e3)}catch(o){console.error("Share error:",o),h.classList.add("hidden"),s("âŒ "+o.message)}}async function ro(){var n;const e=await je();if(e.length===0)return s("ê³µìœ í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.");const t=S.map(o=>e.find(a=>a.id===o)).filter(Boolean);if(t.length===0)return s("ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.");if(t.length>20)return s("í•œ ë²ˆì— ìµœëŒ€ 20ê°œê¹Œì§€ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");s("ê³µìœ  í˜ì´ì§€ ìƒì„± ì¤‘...");try{const o=new Date().toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"}),a=`ë‚´ ì—¬í–‰ ê°€ì´ë“œ ${new Date().toLocaleDateString("ko-KR")}`,i=window.location.origin,r=localStorage.getItem("appLanguage")||"ko",c=bt(a,"ì—¬í–‰ì","íŒŒë¦¬, í”„ë‘ìŠ¤",o,t,i,!1,r),d={name:a,htmlContent:c,guideIds:t.map(u=>u.id),thumbnail:((n=t[0])==null?void 0:n.imageDataUrl)||null,sender:"ì—¬í–‰ì",location:"íŒŒë¦¬, í”„ë‘ìŠ¤",featured:!1},g=await fetch("/api/share/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!g.ok){const u=await g.json();throw new Error(u.error||"ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}const m=await g.json(),p=`${window.location.origin}/s/${m.id}`;window.open(p,"_blank"),U&&se(!1),await Se(),s("âœ… ê°€ì´ë“œ í˜ì´ì§€ê°€ ì—´ë ¸ìŠµë‹ˆë‹¤!")}catch(o){console.error("Download guide error:",o),s("âŒ "+o.message)}}async function an(){try{const e=await fetch(`/api/share/featured/list?t=${Date.now()}`);if(!e.ok)return;const n=(await e.json()).pages||[];co(n)}catch(e){console.warn("Featured gallery not available yet:",e),ve==null||ve.classList.add("hidden")}}function co(e){e.length>0?(ve.classList.remove("hidden"),In.innerHTML=e.map((t,n)=>{const o=t.thumbnail||"",a=`${window.location.origin}/s/${t.id}`,i=t.name||"ê³µìœ  í˜ì´ì§€";return`
                    <div class="flex flex-col gap-2">
                        <div onclick="handleFeaturedClick('${a}')" 
                           class="relative block bg-white rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-all transform hover:scale-105 cursor-pointer"
                           data-testid="featured-${t.id}">
                            ${o?`
                                <img src="${o}" alt="${i}" 
                                     class="w-full aspect-square object-cover">
                            `:`
                                <div class="w-full aspect-square bg-gradient-to-br from-blue-100 to-purple-100 flex items-center justify-center">
                                    <span class="text-4xl">ğŸ“</span>
                                </div>
                            `}
                            <div class="absolute inset-0 bg-gradient-to-b from-black/85 via-black/50 to-black/20 flex items-start justify-center pt-4 px-4">
                                <h3 class="text-white font-extrabold text-center leading-tight line-clamp-2" 
                                    style="font-size: clamp(1rem, 4.5vw, 1.5rem); text-shadow: 0 3px 15px rgba(0,0,0,1), 0 2px 8px rgba(0,0,0,0.9), 0 1px 3px rgba(0,0,0,0.8);">
                                    ${i}
                                </h3>
                            </div>
                            <div class="absolute bottom-2 right-2 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-full flex items-center gap-1 shadow-lg" data-testid="download-count-${t.id}">
                                <svg class="w-4 h-4 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                </svg>
                                <span class="text-xs font-bold text-gray-700">${t.downloadCount||0}</span>
                            </div>
                        </div>
                        <button 
                            onclick="event.stopPropagation(); handleFeaturedDownload('${a}', ${n})"
                            data-testid="button-download-featured-${n}"
                            class="w-full py-2 px-3 flex items-center justify-center rounded-full transition-all interactive-btn"
                            aria-label="ë§í¬ ë³µì‚¬">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" style="color: #4285F4;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                            </svg>
                        </button>
                    </div>
                `}).join("")):ve.classList.add("hidden")}window.handleFeaturedDownload=async function(e,t){console.log("ğŸ“¥ Featured Gallery download clicked:",e,"index:",t);const n=_t(e);console.log("ğŸŒ Translated URL for sharing:",n);let o=!1;try{await navigator.clipboard.writeText(n),o=!0,console.log("âœ… Link copied to clipboard:",n)}catch(a){console.warn("í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨ (ê¶Œí•œ ì—†ìŒ):",a)}if(n.replace(/'/g,"\\'"),w.innerHTML=`
            <div class="p-8 text-center">
                <div class="w-20 h-20 mx-auto mb-6 bg-green-100 rounded-full flex items-center justify-center">
                    <svg class="w-12 h-12 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 mb-4">ë§í¬ ë³µì‚¬ ì™„ë£Œ!</h3>
                ${o?`
                    <p class="text-lg text-gray-700 mb-3">âœ… ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤</p>
                    <p class="text-base text-gray-600">ì¹´ì¹´ì˜¤í†¡, ë¬¸ì, ë©”ì‹ ì € ë“±<br>ì›í•˜ëŠ” ê³³ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”!</p>
                `:`
                    <p class="text-base text-gray-700 mb-4">ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ ê³µìœ í•˜ì„¸ìš”:</p>
                    <div class="bg-gray-100 p-4 rounded-lg mb-3">
                        <p class="text-sm font-mono text-gray-800 break-all">${n}</p>
                    </div>
                    <button id="manualCopyBtn" data-url="${n}"
                            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        ë§í¬ ë³µì‚¬í•˜ê¸°
                    </button>
                `}
            </div>
        `,!o){const a=document.getElementById("manualCopyBtn");a&&(a.onclick=async()=>{try{await navigator.clipboard.writeText(n),a.textContent="ë³µì‚¬ ì™„ë£Œ!",setTimeout(()=>{h.classList.add("hidden"),St()},1e3)}catch(i){alert("ë³µì‚¬ ì‹¤íŒ¨: "+i.message)}})}h.classList.remove("hidden"),setTimeout(()=>{h.classList.add("hidden"),St()},3e3)},window.handleFeaturedClick=async function(e){console.log("ğŸ”µ Featured Gallery clicked:",e);const t=_t(e);console.log("ğŸŒ Translated URL:",t);try{const n=await fetch("/api/auth/user");if(console.log("ğŸ”µ Auth status:",n.ok,n.status),n.ok)console.log("âœ… Authenticated! Opening shared page in new window:",t),window.open(t,"_blank")||(console.error("âŒ íŒì—… ì°¨ë‹¨ë¨! (Fallback: í˜„ì¬ íƒ­ ë¦¬ë‹¤ì´ë ‰íŠ¸)"),window.location.href=t);else{console.log("âŒ Not authenticated, showing auth modal"),console.log("ğŸ’¾ Saving original URL to localStorage (no language param):",e),localStorage.setItem("pendingShareUrl",e),console.log("âœ… Saved! localStorage value:",localStorage.getItem("pendingShareUrl"));const o=document.getElementById("authModal");o?(o.classList.remove("hidden"),console.log("ğŸ“± Auth modal displayed")):(console.error("âŒ Auth modal not found, falling back to Kakao login"),window.location.href="/api/auth/kakao")}}catch(n){console.log("âŒ Auth check failed, showing auth modal:",n),console.log("ğŸ’¾ Saving original URL to localStorage (no language param):",e),localStorage.setItem("pendingShareUrl",e),console.log("âœ… Saved! localStorage value:",localStorage.getItem("pendingShareUrl"));const o=document.getElementById("authModal");o?(o.classList.remove("hidden"),console.log("ğŸ“± Auth modal displayed")):(console.error("âŒ Auth modal not found, falling back to Kakao login"),window.location.href="/api/auth/kakao")}};async function Se(){try{const e=await je();an(),e.length===0?(D.classList.add("hidden"),Nt.classList.remove("hidden")):(Nt.classList.add("hidden"),D.classList.remove("hidden"),D.innerHTML=e.map(t=>`
                    <div class="archive-item relative ${S.includes(t.id)?"selected ring-2 ring-blue-500":""}" // âœ… .has â†’ .includes 
                         data-id="${t.id}" 
                         data-testid="card-archive-${t.id}"
                         tabindex="0">
                        <div class="selection-checkbox">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        ${t.imageDataUrl?`
                            <img src="${t.imageDataUrl}" 
                                 alt="Archive item" 
                                 class="w-full aspect-square object-cover rounded-lg">
                        `:`
                            <div class="w-full aspect-square bg-gradient-to-br from-blue-100 to-purple-100 rounded-lg flex items-center justify-center">
                                <span class="text-3xl">ğŸ’­</span>
                            </div>
                        `}
                    </div>
                `).join(""))}catch(e){console.error("Archive render error:",e),D.innerHTML='<p class="text-red-500 col-span-full text-center text-sm">ë³´ê´€í•¨ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>'}}function sn(e){const t=e.target.closest(".archive-item");if(!t)return;const n=t.dataset.id;if(U){const o=S.indexOf(n);o>-1?(S.splice(o,1),t.classList.remove("selected")):(S.push(n),t.classList.add("selected")),on()}else uo(n)}function lo(e){(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),sn(e))}async function uo(e){try{const n=(await je()).find(c=>c.id===e);if(!n)return;Ie=!0,y={imageDataUrl:n.imageDataUrl,description:n.description,voiceLang:n.voiceLang||null,voiceName:n.voiceName||null},console.log("ğŸ¤ [ë³´ê´€í•¨] ì €ì¥ëœ ìŒì„± ì •ë³´:",n.voiceLang,n.voiceName),kt(!0),n.imageDataUrl?(Y.src=n.imageDataUrl,Y.classList.remove("hidden"),W.classList.remove("bg-friendly")):(Y.classList.add("hidden"),W.classList.add("bg-friendly")),le.classList.add("hidden"),P.classList.remove("hidden","animate-in"),Z.classList.add("hidden"),ye.classList.remove("hidden"),k.cancel(),me(),N.innerHTML="";const o=document.getElementById("locationInfo"),a=document.getElementById("locationName");n.locationName&&o&&a?(a.textContent=n.locationName,o.classList.remove("hidden")):o&&o.classList.add("hidden");const i=n.description||"";(i.match(/[^.?!]+[.?!]+/g)||[i]).forEach(c=>{if(!c)return;const d=document.createElement("span");d.textContent=c.trim()+" ",N.appendChild(d),pe(c.trim(),d)}),_("play")}catch(t){console.error("View archive item error:",t),s("í•­ëª©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}function pe(e,t){De.push({text:e,element:t}),$e||Bt()}async function Bt(){if(await Mn(),De.length===0){$e=!1,_("play"),z&&(z.classList.remove("speaking"),z=null);return}const{text:e,element:t}=De.shift();$e=!0,z&&z.classList.remove("speaking"),t.classList.add("speaking"),z=t;const n=new SpeechSynthesisUtterance(e),o=y.voiceLang,a=y.voiceName,i=localStorage.getItem("appLanguage")||"ko",c=o||{ko:"ko-KR",en:"en-US",ja:"ja-JP","zh-CN":"zh-CN",fr:"fr-FR",de:"de-DE",es:"es-ES"}[i]||"ko-KR";if(console.log("[TTS] ì €ì¥ëœ ìŒì„±:",o,a,"â†’ ì‚¬ìš©:",c),a){const g=k.getVoices().find(m=>m.name===a||m.name.includes(a));g&&(n.voice=g,n.lang=c,n.rate=.9,n.pitch=1,console.log("[TTS] ì €ì¥ëœ ìŒì„± ì‚¬ìš©:",g.name))}else{const d=Ht(c),g=d.priorities,m=d.excludeVoices,p=k.getVoices();let u=null;for(const b of g)if(u=p.find(v=>v.name.includes(b)&&!m.some(T=>v.name.includes(T))),u)break;u||(u=p.find(b=>b.lang.replace("_","-").startsWith(c.substring(0,2)))),n.voice=u||null,n.lang=c,n.rate=.9,n.pitch=1,console.log("[TTS] ì–¸ì–´:",c,"ìŒì„±:",(u==null?void 0:u.name)||"default")}n.onend=()=>{t.classList.remove("speaking"),ae||Bt()},n.onerror=()=>{t.classList.remove("speaking"),ae||Bt()},_("pause"),k.speak(n)}function go(){const e=Date.now();if(e-Gt<300||(Gt=e,!y.description))return;if(k.paused){k.resume(),ae=!1,_("pause");return}if(k.speaking){ae?(k.resume(),ae=!1,_("pause")):(k.pause(),ae=!0,_("play"));return}me();const t=y.description.split(/[.?!]/).filter(o=>o.trim()),n=N.querySelectorAll("span");t.forEach((o,a)=>{o.trim()&&n[a]&&pe(o.trim(),n[a])})}function _(e){if(!A)return;const t=`
            <svg class="w-6 h-6" fill="white" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
            </svg>
        `,n=`
            <svg class="w-6 h-6" fill="white" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
            </svg>
        `,o=`
            <svg class="w-6 h-6 animate-spin" fill="white" viewBox="0 0 20 20">
                <path d="M4 2a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2H4z" />
            </svg>
        `;switch(e){case"play":A.innerHTML=t,A.disabled=!1;break;case"pause":A.innerHTML=n,A.disabled=!1;break;case"loading":A.innerHTML=o,A.disabled=!0;break;case"disabled":A.innerHTML=t,A.disabled=!0;break}}function rn(){const e=localStorage.getItem("customImagePrompt")||vn,t=localStorage.getItem("customTextPrompt")||bn;xe&&(xe.value=e),ke&&(ke.value=t),console.log("ğŸ“ í”„ë¡¬í”„íŠ¸ ë¡œë“œ ì™„ë£Œ (ì´ë¯¸ì§€:",e.substring(0,50)+"...)")}const cn={faq:`<h4>Q1. ì•±ì´ ì²˜ìŒì— ë°”ë¡œ ì•ˆ ì—´ë¦¬ê±°ë‚˜ í™”ë©´ì´ í•˜ì–—ê²Œ ë‚˜ì™€ìš”.</h4>
ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”. Wi-Fië‚˜ ëª¨ë°”ì¼ ë°ì´í„°ê°€ ì—°ê²°ë˜ì–´ ìˆì–´ì•¼ ì •ìƒì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<h4>Q2. ì‚¬ì§„ì„ ì°ì—ˆëŠ”ë° ì„¤ëª…ì´ ì•ˆ ë‚˜ì™€ìš”.</h4>
ì‚¬ì§„ì´ ë„ˆë¬´ ì–´ë‘¡ê±°ë‚˜ íë¦¬ë©´ AIê°€ ì¸ì‹í•˜ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°ì€ ê³³ì—ì„œ ì„ ëª…í•˜ê²Œ ë‹¤ì‹œ ì°ì–´ë³´ì„¸ìš”.

<h4>Q3. ìŒì„±ìœ¼ë¡œ ì§ˆë¬¸í•˜ë©´ ë‹µë³€ì´ ì•ˆ ë‚˜ì™€ìš”.</h4>
ë§ˆì´í¬ ê¶Œí•œì´ í—ˆìš©ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”. ì„¤ì • â†’ ì•± â†’ ì†ì•ˆì— ê°€ì´ë“œ â†’ ê¶Œí•œì—ì„œ ë§ˆì´í¬ë¥¼ í—ˆìš©í•´ì£¼ì„¸ìš”.

<h4>Q4. ì €ì¥í•œ ê°€ì´ë“œê°€ ì‚¬ë¼ì¡Œì–´ìš”.</h4>
ë³´ê´€í•¨ì— ì €ì¥ëœ ê°€ì´ë“œëŠ” ê¸°ê¸°ì— ì €ì¥ë©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ì‚­ì œí•˜ë©´ ë°ì´í„°ê°€ ì‚¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ ì£¼ì˜í•´ì£¼ì„¸ìš”.

<h4>Q5. ê³µìœ  ë§í¬ê°€ ì‘ë™í•˜ì§€ ì•Šì•„ìš”.</h4>
ë§í¬ê°€ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ì‚­ì œë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ê³µìœ  ë§í¬ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.`,terms:`<h4>1. ì„œë¹„ìŠ¤ ëª©ì  ë° ë²”ìœ„</h4>
'ì†ì•ˆì— ê°€ì´ë“œ'ëŠ” AI ê¸°ë°˜ ì—¬í–‰ ê°€ì´ë“œ ì„œë¹„ìŠ¤ë¡œ, ì‚¬ì§„ ì¸ì‹ì„ í†µí•´ ì¥ì†Œ ì •ë³´ì™€ ì„¤ëª…ì„ ì œê³µí•©ë‹ˆë‹¤.

<h4>2. ì„œë¹„ìŠ¤ ì´ìš©</h4>
ë³¸ ì„œë¹„ìŠ¤ëŠ” ë§Œ 14ì„¸ ì´ìƒì˜ ì‚¬ìš©ìê°€ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„œë¹„ìŠ¤ ì´ìš© ì‹œ ë°œìƒí•˜ëŠ” ë°ì´í„° ìš”ê¸ˆì€ ì‚¬ìš©ì ë¶€ë‹´ì…ë‹ˆë‹¤.

<h4>3. AI ìƒì„± ì½˜í…ì¸ </h4>
AIê°€ ìƒì„±í•œ ì •ë³´ëŠ” ì°¸ê³ ìš©ì´ë©°, ì •í™•ì„±ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¤‘ìš”í•œ ê²°ì • ì‹œì—ëŠ” ê³µì‹ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.

<h4>4. ì„œë¹„ìŠ¤ ë³€ê²½ ë° ì¤‘ë‹¨</h4>
ì„œë¹„ìŠ¤ ê°œì„ ì„ ìœ„í•´ ì‚¬ì „ ê³µì§€ ì—†ì´ ê¸°ëŠ¥ì´ ë³€ê²½ë  ìˆ˜ ìˆìœ¼ë©°, ë¶ˆê°€í”¼í•œ ê²½ìš° ì„œë¹„ìŠ¤ê°€ ì¼ì‹œ ì¤‘ë‹¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<h4>5. ì±…ì„ ì œí•œ</h4>
ì„œë¹„ìŠ¤ ì´ìš©ìœ¼ë¡œ ì¸í•´ ë°œìƒí•œ ì†í•´ì— ëŒ€í•´ íšŒì‚¬ëŠ” ë²•ì  ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.`,privacy:`<h4>1. ê°œì¸ ì •ë³´ ìˆ˜ì§‘ ì›ì¹™</h4>
í•„ìˆ˜ ì •ë³´ë§Œ ìµœì†Œí•œìœ¼ë¡œ ìˆ˜ì§‘í•˜ë©°, ì‚¬ìš©ì ë™ì˜ ì—†ì´ ì œ3ìì—ê²Œ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

<h4>2. ìˆ˜ì§‘í•˜ëŠ” ì •ë³´</h4>
- ë¡œê·¸ì¸ ì •ë³´ (ì†Œì…œ ë¡œê·¸ì¸ ì‹œ ì´ë©”ì¼, í”„ë¡œí•„)
- ìœ„ì¹˜ ì •ë³´ (ì‚¬ì§„ì˜ GPS ë°ì´í„°, ì„ íƒì )
- ì‚¬ìš© ê¸°ë¡ (ì„œë¹„ìŠ¤ ê°œì„  ëª©ì )

<h4>3. ì •ë³´ ì´ìš© ëª©ì </h4>
- ë§ì¶¤í˜• ê°€ì´ë“œ ì„œë¹„ìŠ¤ ì œê³µ
- ì„œë¹„ìŠ¤ í’ˆì§ˆ í–¥ìƒ ë° í†µê³„ ë¶„ì„
- ê³ ê° ì§€ì› ë° ë¬¸ì˜ ëŒ€ì‘

<h4>4. ì •ë³´ ë³´ê´€ ê¸°ê°„</h4>
ì„œë¹„ìŠ¤ ì´ìš© ì¢…ë£Œ ì‹œê¹Œì§€ ë³´ê´€í•˜ë©°, íƒˆí‡´ ìš”ì²­ ì‹œ ì¦‰ì‹œ ì‚­ì œí•©ë‹ˆë‹¤.

<h4>5. ì‚¬ìš©ì ê¶Œë¦¬</h4>
ì–¸ì œë“ ì§€ ê°œì¸ì •ë³´ ì—´ëŒ, ìˆ˜ì •, ì‚­ì œë¥¼ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,thirdparty:`<h4>1. ì—°ê²°ëœ ê³„ì • ëª©ë¡</h4>
- Google ë¡œê·¸ì¸: ì´ë©”ì¼, í”„ë¡œí•„ ì •ë³´ í™œìš©
- Kakao ë¡œê·¸ì¸: ì´ë©”ì¼, ë‹‰ë„¤ì„ í™œìš©

<h4>2. ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™</h4>
- Google Maps API: ìœ„ì¹˜ ì •ë³´ í‘œì‹œ
- Google Cloud Vision/Gemini: ì´ë¯¸ì§€ ë¶„ì„ ë° AI ì‘ë‹µ

<h4>3. ë°ì´í„° ê³µìœ  ë²”ìœ„</h4>
ì™¸ë¶€ ì„œë¹„ìŠ¤ì—ëŠ” ì„œë¹„ìŠ¤ ì œê³µì— í•„ìš”í•œ ìµœì†Œí•œì˜ ë°ì´í„°ë§Œ ì „ë‹¬ë©ë‹ˆë‹¤.

<h4>4. ì—°ê²° í•´ì œ</h4>
ê° ì†Œì…œ ê³„ì •ì˜ ì—°ê²°ëœ ì•± ê´€ë¦¬ì—ì„œ ì ‘ê·¼ ê¶Œí•œì„ í•´ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`};function mo(){["faq","terms","privacy","thirdparty"].forEach(t=>{const n=document.querySelector(`#content-user-${t} .user-settings-content-body`);n&&cn[t]&&(n.innerHTML=cn[t])})}function Ve(e){const t=document.getElementById(`content-user-${e}`),n=document.getElementById(`icon-user-${e}`);t&&(t.classList.toggle("open"),n&&(n.style.transform=t.classList.contains("open")?"rotate(180deg)":""))}async function ho(){if(!I||!E)return;if(!("Notification"in window)||!("serviceWorker"in navigator)||!("PushManager"in window)){I.disabled=!0,E.textContent="ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤";return}const e=Notification.permission;if(e==="denied"){I.checked=!1,I.disabled=!0,E.textContent="ì•Œë¦¼ì´ ì°¨ë‹¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤ (ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ í—ˆìš© í•„ìš”)";return}try{const t=await navigator.serviceWorker.ready;if(await t.pushManager.getSubscription())I.checked=!0,E.textContent="ì•Œë¦¼ì´ ì¼œì ¸ ìˆìŠµë‹ˆë‹¤";else if(await Le()&&e!=="denied"){I.checked=!0,E.textContent="ì•Œë¦¼ ì„¤ì • ì¤‘...";const a=await Notification.requestPermission();if(a==="granted")try{const r=ln("BEuc2WPE8n32XPc_uDZ_Na-vSgVvx_P4uRsSFuTYi-oD1kobkIBKtSFbtnneebC3wt8OnknpizRM98NCLnuHa38"),c=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r});if((await fetch("/api/push/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({endpoint:c.endpoint,keys:{p256dh:btoa(String.fromCharCode.apply(null,new Uint8Array(c.getKey("p256dh")))),auth:btoa(String.fromCharCode.apply(null,new Uint8Array(c.getKey("auth"))))},userAgent:navigator.userAgent})})).ok)E.textContent="ì•Œë¦¼ì´ ì¼œì ¸ ìˆìŠµë‹ˆë‹¤";else throw new Error("ì„œë²„ êµ¬ë… ë“±ë¡ ì‹¤íŒ¨")}catch(i){console.error("ìë™ í‘¸ì‹œ êµ¬ë… ì˜¤ë¥˜:",i),I.checked=!1,E.textContent="ì•Œë¦¼ì„ ì¼œë ¤ë©´ í† ê¸€ì„ ëˆ„ë¥´ì„¸ìš”"}else a==="denied"?(I.checked=!1,I.disabled=!0,E.textContent="ì•Œë¦¼ì´ ì°¨ë‹¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤ (ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ í—ˆìš© í•„ìš”)"):(I.checked=!1,E.textContent="ì•Œë¦¼ì„ ì¼œë ¤ë©´ í† ê¸€ì„ ëˆ„ë¥´ì„¸ìš”")}else I.checked=!1,E.textContent="ë¡œê·¸ì¸ í›„ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤"}catch(t){console.error("í‘¸ì‹œ ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:",t),I.checked=!1,E.textContent="ì•Œë¦¼ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}}function ln(e){const t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(n),a=new Uint8Array(o.length);for(let i=0;i<o.length;++i)a[i]=o.charCodeAt(i);return a}async function po(){if(!("Notification"in window)||!("serviceWorker"in navigator)||!("PushManager"in window)){s("ì´ ë¸Œë¼ìš°ì €ëŠ” í‘¸ì‹œ ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"),I.checked=!1;return}if(!await Le()){s("í‘¸ì‹œ ì•Œë¦¼ì„ ì‚¬ìš©í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤"),I.checked=!1,E.textContent="ë¡œê·¸ì¸ í•„ìš”";return}if(I.checked){const t=await Notification.requestPermission();if(t!=="granted"){I.checked=!1,E.textContent=t==="denied"?"ì•Œë¦¼ì´ ì°¨ë‹¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤ (ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ í—ˆìš© í•„ìš”)":"ì•Œë¦¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”",s("ì•Œë¦¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤");return}try{E.textContent="ì•Œë¦¼ ì„¤ì • ì¤‘...";const n=await navigator.serviceWorker.ready,a=ln("BEuc2WPE8n32XPc_uDZ_Na-vSgVvx_P4uRsSFuTYi-oD1kobkIBKtSFbtnneebC3wt8OnknpizRM98NCLnuHa38"),i=await n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:a});if((await fetch("/api/push/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({endpoint:i.endpoint,keys:{p256dh:btoa(String.fromCharCode.apply(null,new Uint8Array(i.getKey("p256dh")))),auth:btoa(String.fromCharCode.apply(null,new Uint8Array(i.getKey("auth"))))},userAgent:navigator.userAgent})})).ok)E.textContent="ì•Œë¦¼ì´ ì¼œì ¸ ìˆìŠµë‹ˆë‹¤",s("í‘¸ì‹œ ì•Œë¦¼ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤");else throw new Error("ì„œë²„ êµ¬ë… ë“±ë¡ ì‹¤íŒ¨")}catch(n){console.error("í‘¸ì‹œ êµ¬ë… ì˜¤ë¥˜:",n),I.checked=!1,E.textContent="ì•Œë¦¼ ì„¤ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤",s("í‘¸ì‹œ ì•Œë¦¼ ì„¤ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}}else try{E.textContent="ì•Œë¦¼ í•´ì œ ì¤‘...";const n=await(await navigator.serviceWorker.ready).pushManager.getSubscription();n&&(await fetch("/api/push/unsubscribe",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({endpoint:n.endpoint})}),await n.unsubscribe()),E.textContent="ì•Œë¦¼ì´ êº¼ì ¸ ìˆìŠµë‹ˆë‹¤",s("í‘¸ì‹œ ì•Œë¦¼ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤")}catch(t){console.error("í‘¸ì‹œ êµ¬ë… í•´ì œ ì˜¤ë¥˜:",t),E.textContent="ì•Œë¦¼ í•´ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤",s("ì•Œë¦¼ í•´ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}}function fo(){Pe&&Pe.classList.remove("hidden")}function Ge(){Pe&&Pe.classList.add("hidden")}async function wo(){const e=document.getElementById("user-qr-image");if(!e){s("QR ì½”ë“œ ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");return}async function t(){try{const n=await fetch("/api/profile/qr-copy-reward",{method:"POST",credentials:"include"});if(n.ok){const o=await n.json();if(o.success)return s(`QR ë³µì‚¬ ì™„ë£Œ! +2 í¬ë ˆë”§ (ì”ì•¡: ${o.balance})`),!0}}catch{console.log("QR ë¦¬ì›Œë“œ ë¯¸ì§€ê¸‰ (ë¹„íšŒì› ë˜ëŠ” ì˜¤ë¥˜)")}return!1}try{const n=document.createElement("canvas");n.width=e.naturalWidth||250,n.height=e.naturalHeight||250,n.getContext("2d").drawImage(e,0,0),n.toBlob(async a=>{try{await navigator.clipboard.write([new ClipboardItem({"image/png":a})]),await t()||s("QR ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"),setTimeout(Ge,3e3)}catch{const r=window.location.origin;await navigator.clipboard.writeText(r),await t()||s("ì•± ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"),setTimeout(Ge,3e3)}},"image/png")}catch(n){console.error("QR ë³µì‚¬ ì‹¤íŒ¨:",n);try{const o=window.location.origin;await navigator.clipboard.writeText(o),await t()||s("ì•± ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"),setTimeout(Ge,3e3)}catch{s("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í™”ë©´ì„ ìº¡ì²˜í•´ì£¼ì„¸ìš”."),setTimeout(Ge,3e3)}}}function yo(){Me&&(Me.classList.remove("hidden"),V&&(V.value=""),j&&j.classList.add("hidden"))}function dn(){Me&&Me.classList.add("hidden")}async function un(){const e=V==null?void 0:V.value;if(!e){j&&(j.textContent="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”",j.classList.remove("hidden"));return}try{(await fetch("/api/admin/auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})})).ok?(localStorage.setItem("adminAuthenticated","true"),localStorage.setItem("adminAuthTime",Date.now().toString()),localStorage.setItem("adminPassword",e),dn(),s("ê´€ë¦¬ì ì¸ì¦ ì„±ê³µ"),vo()):(j&&(j.textContent="ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤",j.classList.remove("hidden")),V&&(V.value=""))}catch(t){console.error("ì¸ì¦ ì˜¤ë¥˜:",t),j&&(j.textContent="ì¸ì¦ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",j.classList.remove("hidden"))}}async function vo(){Oe();try{if((await fetch("/api/admin/featured")).ok){localStorage.setItem("adminAuthenticated","true"),localStorage.setItem("adminAuthTime",Date.now().toString()),G==null||G.classList.add("hidden"),H==null||H.classList.remove("hidden");const t=document.getElementById("adminDashboardLink");t&&t.classList.remove("hidden"),await gn()}else{localStorage.removeItem("adminAuthenticated"),localStorage.removeItem("adminAuthTime"),localStorage.removeItem("adminPassword"),te&&(te.value=""),G==null||G.classList.remove("hidden"),H==null||H.classList.add("hidden");const t=document.getElementById("adminDashboardLink");t&&t.classList.add("hidden")}}catch{localStorage.removeItem("adminAuthenticated"),localStorage.removeItem("adminAuthTime"),localStorage.removeItem("adminPassword"),te&&(te.value=""),G==null||G.classList.remove("hidden"),H==null||H.classList.add("hidden");const t=document.getElementById("adminDashboardLink");t&&t.classList.add("hidden")}rn(),ge(Rt)}async function bo(e){e.preventDefault();const t=te.value;try{if((await fetch("/api/admin/auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:t})})).ok){localStorage.setItem("adminAuthenticated","true"),localStorage.setItem("adminAuthTime",Date.now().toString()),localStorage.setItem("adminPassword",t),G.classList.add("hidden"),H.classList.remove("hidden"),s("ê´€ë¦¬ì ì¸ì¦ ì„±ê³µ");const o=document.getElementById("adminDashboardLink");o&&o.classList.remove("hidden"),await gn()}else s("ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤."),te.value=""}catch(n){console.error("ì¸ì¦ ì˜¤ë¥˜:",n),s("ì¸ì¦ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),te.value=""}}async function gn(){await He();const e=document.getElementById("shareSearchInput");if(e){let t;e.addEventListener("input",n=>{clearTimeout(t),t=setTimeout(()=>{mn(n.target.value)},300)})}}async function mn(e){const t=document.getElementById("searchResults");if(t){if(!e||e.trim().length===0){t.innerHTML='<p class="text-sm text-gray-400 text-center py-4">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>';return}try{t.innerHTML='<p class="text-sm text-gray-400 text-center py-4">ê²€ìƒ‰ ì¤‘...</p>';const n=await fetch(`/api/admin/all-shares?search=${encodeURIComponent(e)}`,{credentials:"include"});if(!n.ok)throw new Error("ê²€ìƒ‰ ì‹¤íŒ¨");const o=await n.json();if(!o||o.length===0){t.innerHTML=`
                    <p class="text-sm text-gray-400 text-center py-4">
                        "<span class="font-semibold">${e}</span>" ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤
                    </p>
                `;return}t.innerHTML=o.map(a=>`
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200 hover:border-yellow-400 transition-colors">
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-gray-900 truncate">${a.name}</p>
                        <div class="flex items-center gap-3 mt-1">
                            <span class="text-xs text-gray-500">${a.downloadCount||0}íšŒ ë‹¤ìš´ë¡œë“œ</span>
                            <span class="text-xs text-gray-400">${new Date(a.createdAt).toLocaleDateString()}</span>
                            ${a.featured?'<span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded">Featured</span>':""}
                        </div>
                    </div>
                    ${a.featured?`
                        <span class="ml-3 px-3 py-1.5 bg-gray-200 text-gray-500 text-sm font-medium rounded cursor-not-allowed whitespace-nowrap">
                            ì´ë¯¸ ì¶”ê°€ë¨
                        </span>
                    `:`
                        <button 
                            onclick="addFeaturedById('${a.id}')" 
                            class="ml-3 px-3 py-1.5 bg-yellow-500 text-white text-sm font-medium rounded hover:bg-yellow-600 transition-colors whitespace-nowrap"
                            data-testid="button-add-featured-${a.id}">
                            ì¶”ê°€
                        </button>
                    `}
                </div>
            `).join("")}catch(n){console.error("ê³µìœ  í˜ì´ì§€ ê²€ìƒ‰ ì˜¤ë¥˜:",n),t.innerHTML='<p class="text-sm text-red-400 text-center py-4">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</p>'}}}async function He(){try{const e=await fetch("/api/admin/featured",{credentials:"include"});if(!e.ok)throw new Error("Failed to load featured");const t=await e.json(),n=document.getElementById("featuredList"),o=document.getElementById("featuredCount");if(o&&(o.textContent=t.length),!n)return;if(!t||t.length===0){n.innerHTML='<p class="text-sm text-gray-400">Featured í˜ì´ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</p>';return}n.innerHTML=t.map(a=>`
                <div class="flex items-center justify-between p-2 bg-yellow-50 rounded">
                    <span class="text-sm font-medium text-gray-800">${a.name}</span>
                    <div class="flex items-center gap-2">
                        <button onclick="editFeatured('${a.id}')" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                            í¸ì§‘
                        </button>
                        <button onclick="removeFeatured('${a.id}')" class="text-red-500 hover:text-red-700 text-sm font-medium">
                            ì œê±°
                        </button>
                    </div>
                </div>
            `).join("")}catch(e){console.error("Featured ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:",e);const t=document.getElementById("featuredList");t&&(t.innerHTML='<p class="text-sm text-red-400">ë¡œë“œ ì‹¤íŒ¨</p>')}}window.addFeaturedById=async function(e){if(!e){s("ê³µìœ  í˜ì´ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”");return}try{const t=await fetch(`/api/admin/featured/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"}),n=await t.json();if(t.ok){s("Featuredì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!"),await He();const o=document.getElementById("shareSearchInput");o&&o.value&&await mn(o.value)}else s(n.error||"Featured ì¶”ê°€ ì‹¤íŒ¨")}catch(t){console.error("Featured ì¶”ê°€ ì˜¤ë¥˜:",t),s("Featured ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ ë°œìƒ")}},window.removeFeatured=async function(e){if(confirm("Featuredì—ì„œ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))try{const t=await fetch(`/api/admin/featured/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"}),n=await t.json();t.ok?(s("Featuredì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤"),await He()):s(n.error||"Featured ì œê±° ì‹¤íŒ¨")}catch(t){console.error("Featured ì œê±° ì˜¤ë¥˜:",t),s("Featured ì œê±° ì¤‘ ì˜¤ë¥˜ ë°œìƒ")}},window.editFeatured=async function(e){try{s("ğŸ“ í¸ì§‘ ì •ë³´ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...");const t=await fetch(`/api/admin/featured/${e}/data`,{credentials:"include"});if(!t.ok){const r=await t.json();throw new Error(r.error||"ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨")}const n=await t.json(),{page:o,guides:a}=n;console.log("ğŸ“Š í¸ì§‘ ë°ì´í„°:",{page:o,guides:a,guidesCount:a==null?void 0:a.length}),document.getElementById("editTitle").value=o.name||"",document.getElementById("editSender").value=o.sender||"ì—¬í–‰ì",document.getElementById("editLocation").value=o.location||"ë¯¸ì§€ì •",document.getElementById("editDate").value=o.date||new Date(o.createdAt).toISOString().split("T")[0];const i=a.map((r,c)=>{const d=r.imageUrl||"",g=c===0,m=c===a.length-1;return`
                    <div class="guide-item flex items-center gap-2 p-3 bg-white rounded-lg border-2 border-gray-300 mb-2" data-guide-id="${r.id}">
                        <img src="${d}" alt="ê°€ì´ë“œ ${c+1}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px; flex-shrink: 0;">
                        <span class="font-medium text-gray-700 flex-1">ê°€ì´ë“œ ${c+1}</span>
                        <div class="flex flex-col gap-1">
                            <button onclick="moveGuideUp(this)" ${g?"disabled":""} class="px-3 py-1 bg-blue-500 text-white rounded disabled:bg-gray-300 disabled:cursor-not-allowed text-lg font-bold" style="min-width: 40px; min-height: 36px;">â–²</button>
                            <button onclick="moveGuideDown(this)" ${m?"disabled":""} class="px-3 py-1 bg-blue-500 text-white rounded disabled:bg-gray-300 disabled:cursor-not-allowed text-lg font-bold" style="min-width: 40px; min-height: 36px;">â–¼</button>
                        </div>
                    </div>
                `}).join("");document.getElementById("guideList").innerHTML=i,document.getElementById("editFeaturedModal").classList.remove("hidden"),document.getElementById("saveFeaturedBtn").onclick=async()=>{const r=document.getElementById("editTitle").value,c=document.getElementById("editSender").value,d=document.getElementById("editLocation").value,g=document.getElementById("editDate").value;if(!r||!c||!d||!g){s("âŒ ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}const m=document.querySelectorAll(".guide-item"),p=Array.from(m).map(u=>u.dataset.guideId);try{s("ğŸ’¾ ì €ì¥ ì¤‘...");const u=await fetch(`/api/admin/featured/${e}/regenerate`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({title:r,sender:c,location:d,date:g,guideIds:p})});if(!u.ok){const b=await u.json();throw new Error(b.error||"HTML ì¬ìƒì„± ì‹¤íŒ¨")}s("âœ… Featured í˜ì´ì§€ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!"),closeEditModal(),He()}catch(u){console.error("Featured í¸ì§‘ ì˜¤ë¥˜:",u),s("âŒ í¸ì§‘ ì‹¤íŒ¨: "+u.message)}}}catch(t){console.error("Featured í¸ì§‘ ì˜¤ë¥˜:",t),s("âŒ í¸ì§‘ ì‹¤íŒ¨: "+t.message)}},window.closeEditModal=function(){document.getElementById("editFeaturedModal").classList.add("hidden")},window.moveGuideUp=function(e){const t=e.closest(".guide-item"),n=t.previousElementSibling;n&&(t.parentNode.insertBefore(t,n),hn())},window.moveGuideDown=function(e){const t=e.closest(".guide-item"),n=t.nextElementSibling;n&&(t.parentNode.insertBefore(n,t),hn())};function hn(){const e=document.querySelectorAll(".guide-item");e.forEach((t,n)=>{const o=t.querySelector("span.font-medium");o&&(o.textContent=`ê°€ì´ë“œ ${n+1}`);const a=t.querySelector("button:first-of-type"),i=t.querySelector("button:last-of-type");a.disabled=n===0,i.disabled=n===e.length-1})}function xo(){const e=xe==null?void 0:xe.value.trim(),t=ke==null?void 0:ke.value.trim();if(!e||!t){s("ëª¨ë“  í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}localStorage.setItem("customImagePrompt",e),localStorage.setItem("customTextPrompt",t),console.log("ğŸ’¾ í”„ë¡¬í”„íŠ¸ ì €ì¥ ì™„ë£Œ"),s("í”„ë¡¬í”„íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")}function ko(){confirm("í”„ë¡¬í”„íŠ¸ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&(localStorage.removeItem("customImagePrompt"),localStorage.removeItem("customTextPrompt"),rn(),s("í”„ë¡¬í”„íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤."))}function Lo(){if(!(mt!=null&&mt.value.trim()))return s("ì´ë¯¸ì§€ ìƒì„±ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");ne&&(ne.disabled=!0),s("ë©‹ì§„ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê³  ìˆì–´ìš”...",3e3),setTimeout(()=>{s("ì´ë¯¸ì§€ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! (ë°ëª¨)"),ne&&(ne.disabled=!1)},4e3)}function Io(){if(!(ht!=null&&ht.value.trim()))return s("ì˜ìƒ ì œì‘ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");oe&&(oe.disabled=!0),s("AIê°€ ì˜ìƒì„ ì œì‘ ì¤‘ì…ë‹ˆë‹¤ (ì•½ 10ì´ˆ ì†Œìš”)...",8e3),setTimeout(()=>{s("ì˜ìƒì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤! (ë°ëª¨)"),oe&&(oe.disabled=!1)},9e3)}async function Eo(){var p,u,b;const e=document.getElementById("adminNotificationType"),t=document.getElementById("adminNotificationTitle"),n=document.getElementById("adminNotificationMessage"),o=document.getElementById("adminNotificationLink"),a=document.getElementById("adminSendNotificationBtn"),i=document.getElementById("adminNotificationResult"),r=e==null?void 0:e.value,c=(p=t==null?void 0:t.value)==null?void 0:p.trim(),d=(u=n==null?void 0:n.value)==null?void 0:u.trim(),g=((b=o==null?void 0:o.value)==null?void 0:b.trim())||null;if(!c||!d){s("ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}const m=localStorage.getItem("adminPassword")||"";if(!m){s("ê´€ë¦¬ì ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.");return}a&&(a.disabled=!0),s("ì•Œë¦¼ ë°œì†¡ ì¤‘...");try{const v=await fetch("/api/admin/notifications/broadcast",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:r,title:c,message:d,link:g,adminPassword:m})}),T=await v.json();if(v.ok&&T.success)s(`ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ! (í‘¸ì‹œ: ${T.pushSent}ëª…)`),i&&(i.textContent=`âœ… ë°œì†¡ ì™„ë£Œ: í‘¸ì‹œ ${T.pushSent}ëª… ì„±ê³µ, ${T.pushFailed}ëª… ì‹¤íŒ¨`,i.className="text-sm text-center text-green-600",i.classList.remove("hidden")),t&&(t.value=""),n&&(n.value=""),o&&(o.value="");else throw new Error(T.error||"ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨")}catch(v){console.error("ì•Œë¦¼ ë°œì†¡ ì˜¤ë¥˜:",v),s("ì•Œë¦¼ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),i&&(i.textContent=`âŒ ë°œì†¡ ì‹¤íŒ¨: ${v.message}`,i.className="text-sm text-center text-red-600",i.classList.remove("hidden"))}finally{a&&(a.disabled=!1)}}_e==null||_e.addEventListener("click",en),fe==null||fe.addEventListener("click",()=>ie("shoot",Yn,800)),we==null||we.addEventListener("click",()=>L.click()),ce==null||ce.addEventListener("click",()=>ie("mic",eo,500)),ze==null||ze.addEventListener("click",()=>ie("archive",Ee,300)),L==null||L.addEventListener("change",Zn),Ke==null||Ke.addEventListener("click",()=>Ie?Ee():xt()),We==null||We.addEventListener("click",xt),et==null||et.addEventListener("click",Ee),lt==null||lt.addEventListener("click",Lt),(pn=document.getElementById("toggle-user-faq"))==null||pn.addEventListener("click",()=>Ve("faq")),(fn=document.getElementById("toggle-user-terms"))==null||fn.addEventListener("click",()=>Ve("terms")),(wn=document.getElementById("toggle-user-privacy"))==null||wn.addEventListener("click",()=>Ve("privacy")),(yn=document.getElementById("toggle-user-thirdparty"))==null||yn.addEventListener("click",()=>Ve("thirdparty")),I==null||I.addEventListener("change",po),tt==null||tt.addEventListener("click",()=>{window.open("https://youtu.be/JJ65XZvBgsk","_blank")}),nt==null||nt.addEventListener("click",fo),st==null||st.addEventListener("click",wo),ot==null||ot.addEventListener("click",yo),at==null||at.addEventListener("click",dn),it==null||it.addEventListener("click",un),V==null||V.addEventListener("keypress",e=>{e.key==="Enter"&&un()});const Be=document.getElementById("adminSettingsLanguageSelect"),So=localStorage.getItem("appLanguage")||"ko";Be&&(Be.value=So),Be==null||Be.addEventListener("change",e=>{const t=e.target.value;console.log("ğŸŒ ì–¸ì–´ ë³€ê²½:",t),localStorage.setItem("appLanguage",t);const n=window.location.hostname;document.cookie=`googtrans=/ko/${t}; path=/; domain=${n}`,document.cookie=`googtrans=/ko/${t}; path=/`,s(`ì–¸ì–´ê°€ ${{ko:"í•œêµ­ì–´",en:"English",ja:"æ—¥æœ¬èª","zh-CN":"ä¸­æ–‡",fr:"FranÃ§ais",de:"Deutsch",es:"EspaÃ±ol"}[t]}ë¡œ ë³€ê²½ë©ë‹ˆë‹¤...`),setTimeout(()=>{window.location.reload()},500)});const Ct=document.getElementById("adminTestLogoutBtn");Ct==null||Ct.addEventListener("click",()=>{console.log("ğŸ”“ Test logout clicked"),confirm("ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (í…ŒìŠ¤íŠ¸ìš©)")&&(console.log("âœ… User confirmed, logging out..."),window.location.href="/api/auth/logout")}),A==null||A.addEventListener("click",go),ee==null||ee.addEventListener("click",()=>ie("save",oo,500)),qe==null||qe.addEventListener("click",()=>P.classList.toggle("hidden")),Xe==null||Xe.addEventListener("click",async()=>{ie("share",async()=>{if(!U){s("ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”"),se(!0);return}if(S.length===0){s("ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”");return}await io()},600)}),Ye==null||Ye.addEventListener("click",async()=>{ie("delete",async()=>{if(!U){s("ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”"),se(!0);return}if(S.length===0){s("ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”");return}await ao()},600)});const Tt=document.getElementById("downloadSelectedBtn");Tt==null||Tt.addEventListener("click",async()=>{ie("download",async()=>{if(S.length===0){s("ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”");return}await ro()},600)}),Ze==null||Ze.addEventListener("click",()=>{Lt()}),Je==null||Je.addEventListener("click",()=>se(!1)),D==null||D.addEventListener("click",sn),D==null||D.addEventListener("keydown",lo),dt==null||dt.addEventListener("submit",bo),ut==null||ut.addEventListener("click",xo),gt==null||gt.addEventListener("click",ko),ne==null||ne.addEventListener("click",Lo),oe==null||oe.addEventListener("click",Io);const Mt=document.getElementById("adminSendNotificationBtn");Mt==null||Mt.addEventListener("click",Eo),C==null||C.addEventListener("click",()=>{console.log("âŒ ì¸ì¦ ì·¨ì†Œ - ëª¨ë‹¬ ë‹«ê¸°"),l.classList.add("hidden"),l.classList.add("pointer-events-none"),l.classList.remove("pointer-events-auto"),localStorage.removeItem("pendingShareUrl"),console.log("ğŸ—‘ï¸ pendingShareUrl ì‚­ì œ ì™„ë£Œ")}),q==null||q.addEventListener("click",()=>{console.log("ğŸ”µ Google ë¡œê·¸ì¸");const e=500,t=600,n=(window.screen.width-e)/2,o=(window.screen.height-t)/2,a=window.open("/api/auth/google","google_oauth",`width=${e},height=${t},left=${n},top=${o},toolbar=no,menubar=no,scrollbars=yes`);(!a||a.closed)&&(console.error("âŒ íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ê°™ì€ íƒ­ìœ¼ë¡œ ì§„í–‰í•©ë‹ˆë‹¤."),window.location.href="/api/auth/google")}),re==null||re.addEventListener("click",()=>{console.log("ğŸ”µ Kakao ë¡œê·¸ì¸");const e=500,t=600,n=(window.screen.width-e)/2,o=(window.screen.height-t)/2,a=window.open("/api/auth/kakao","kakao_oauth",`width=${e},height=${t},left=${n},top=${o},toolbar=no,menubar=no,scrollbars=yes`);(!a||a.closed)&&(console.error("âŒ íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ê°™ì€ íƒ­ìœ¼ë¡œ ì§„í–‰í•©ë‹ˆë‹¤."),window.location.href="/api/auth/kakao")}),l==null||l.addEventListener("click",e=>{e.target===l&&(l.classList.add("hidden"),l.classList.add("pointer-events-none"),l.classList.remove("pointer-events-auto"))}),Qn(),window.addSampleImages=async function(){const e=[{id:"sample-1",imageDataUrl:"assets/sample1.png",description:"ì‚¬ëª¨íŠ¸ë¼ì¼€ì˜ ë‹ˆì¼€. ê¸°ì›ì „ 190ë…„ê²½ ì œì‘ëœ í—¬ë ˆë‹ˆì¦˜ ì‹œëŒ€ì˜ ê±¸ì‘ì…ë‹ˆë‹¤. ìŠ¹ë¦¬ì˜ ì—¬ì‹  ë‹ˆì¼€ê°€ ë°°ì˜ ì„ ìˆ˜ì— ë‚´ë ¤ì•‰ëŠ” ìˆœê°„ì„ í¬ì°©í•œ ì´ ì¡°ê°ì€ ì—­ë™ì ì¸ ì›€ì§ì„ê³¼ ë°”ëŒì— íœ˜ë‚ ë¦¬ëŠ” ì˜·ìë½ì˜ í‘œí˜„ì´ íƒì›”í•©ë‹ˆë‹¤. ë£¨ë¸Œë¥´ ë°•ë¬¼ê´€ ê³„ë‹¨ ìœ„ì—ì„œ ê´€ëŒê°ì„ ë§ì´í•˜ëŠ” ì´ ì‘í’ˆì€ ê³ ëŒ€ ê·¸ë¦¬ìŠ¤ ì¡°ê°ì˜ ì •ìˆ˜ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤."}];for(const t of e)try{await Qt(t)}catch(n){console.log("Sample already exists or error:",n)}await Se(),s("ìƒ˜í”Œ ì´ë¯¸ì§€ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!"),console.log("âœ… ìƒ˜í”Œ ì´ë¯¸ì§€ ì¶”ê°€ ì™„ë£Œ!")},window.addEventListener("hashchange",()=>{const e=window.location.hash;e==="#archive"?Ee():e===""||e==="#main"?xt():e==="#settings"?Lt():e==="#features"&&showFeaturesPage()}),"serviceWorker"in navigator&&(window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(e=>{console.log("SW registered: ",e),e.addEventListener("updatefound",()=>{const t=e.installing;t.addEventListener("statechange",()=>{if(t.state==="activated"){if(!navigator.serviceWorker.controller)return;console.log("ğŸ”„ ìƒˆ ë²„ì „ ì—…ë°ì´íŠ¸ ì™„ë£Œ, í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨..."),window.location.reload()}})})}).catch(e=>console.log("SW registration failed: ",e))}),navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("ğŸ”„ Service Worker ì—…ë°ì´íŠ¸ë¨, í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨..."),window.location.reload()}))});
